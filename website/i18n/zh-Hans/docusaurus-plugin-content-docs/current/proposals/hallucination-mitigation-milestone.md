---
translation:
  source_commit: "bac2743"
  source_file: "docs/proposals/hallucination-mitigation-milestone.md"
  outdated: false
---

# TruthLensï¼šå®æ—¶ hallucination ç¼“è§£

**ç‰ˆæœ¬ï¼š** 1.0
**ä½œè€…ï¼š** vLLM Semantic Router å›¢é˜Ÿ
**æ—¥æœŸï¼š** 2025 å¹´ 12 æœˆ

---

## æ‘˜è¦

å¤§è¯­è¨€æ¨¡å‹ (LLM) å±•ç¤ºäº†å“è¶Šçš„èƒ½åŠ›ï¼Œä½†å…¶äº§ç”Ÿ hallucinationï¼ˆæµç•…ä½†äº‹å®é”™è¯¯æˆ–æ— æ ¹æ®çš„å†…å®¹ï¼‰çš„å€¾å‘ä»ç„¶æ˜¯ä¼ä¸šé‡‡ç”¨ AI çš„å…³é”®éšœç¢ã€‚è¡Œä¸šè°ƒæŸ¥ä¸€è‡´è¡¨æ˜ï¼Œhallucination é£é™©æ˜¯é˜»æ­¢ç»„ç»‡åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½² LLM é©±åŠ¨çš„åº”ç”¨ç¨‹åºçš„é¦–è¦æ‹…å¿§ï¼Œç‰¹åˆ«æ˜¯åœ¨åŒ»ç–—ä¿å¥ã€é‡‘èå’Œæ³•å¾‹æœåŠ¡ç­‰é«˜é£é™©é¢†åŸŸã€‚

æˆ‘ä»¬æå‡ºäº† **TruthLens**ï¼Œè¿™æ˜¯ä¸€ä¸ªé›†æˆåˆ° vLLM Semantic Router ä¸­çš„å®æ—¶ hallucination æ£€æµ‹å’Œç¼“è§£æ¡†æ¶ã€‚é€šè¿‡åœ¨ inference ç½‘å…³å±‚å®šä½ hallucination æ§åˆ¶ï¼ŒTruthLens æä¾›äº†ä¸€ä¸ªä¸æ¨¡å‹æ— å…³çš„é›†ä¸­å¼è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å¯é…ç½®çš„ç¼“è§£ç­–ç•¥è§£å†³â€œå‡†ç¡®ç‡-å»¶è¿Ÿ-æˆæœ¬â€ä¸‰è§’å½¢é—®é¢˜ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®å¯¹æˆæœ¬å’Œå‡†ç¡®ç‡æƒè¡¡çš„å®¹å¿åº¦ä»ä¸‰ç§æ“ä½œæ¨¡å¼ä¸­è¿›è¡Œé€‰æ‹©ï¼š(1) **è½»é‡çº§æ¨¡å¼**â€”â€”å¸¦æœ‰è­¦å‘Šæ³¨å…¥çš„å•è½®æ£€æµ‹ï¼Œ(2) **æ ‡å‡†æ¨¡å¼**â€”â€”ä½¿ç”¨ç›¸åŒæ¨¡å‹çš„è¿­ä»£è‡ªæˆ‘ç»†åŒ–ï¼Œä»¥åŠ (3) **é«˜çº§æ¨¡å¼**â€”â€”å¤šæ¨¡å‹äº¤å‰éªŒè¯å’Œåä½œçº é”™ã€‚è¿™ç§è®¾è®¡ä½¿ç»„ç»‡èƒ½å¤Ÿéƒ¨ç½²å€¼å¾—ä¿¡èµ–çš„ AI ç³»ç»Ÿï¼ŒåŒæ—¶ä¿æŒå¯¹è¿è¥æˆæœ¬å’Œå“åº”å»¶è¿Ÿçš„æ§åˆ¶ã€‚

---

## 1. å¼•è¨€ï¼šä¼ä¸šçº§ AI ä¸­çš„ hallucination å±æœº

### 1.1 æ ¸å¿ƒé—®é¢˜

hallucination æ˜¯å½“ä»Šä¼ä¸šé‡‡ç”¨ AI çš„æœ€é‡è¦éšœç¢ã€‚ä¸ä¼ ç»Ÿçš„è½¯ä»¶é”™è¯¯ä¸åŒï¼ŒLLM çš„ hallucination æ˜¯ï¼š

- **ä¸å¯é¢„æµ‹çš„**ï¼šå®ƒä»¬åœ¨ä¸åŒçš„æŸ¥è¯¢å’Œä¸Šä¸‹æ–‡ä¸­éšæœºå‘ç”Ÿ
- **å…·æœ‰è¯´æœåŠ›çš„**ï¼šhallucination å†…å®¹é€šå¸¸çœ‹èµ·æ¥æµç•…ã€è‡ªä¿¡ä¸”ä¼¼ä¹åˆç†
- **é«˜é£é™©çš„**ï¼šåœ¨åŒ»ç–—ã€æ³•å¾‹æˆ–é‡‘èé¢†åŸŸçš„ä¸€æ¬¡ hallucination å¯èƒ½ä¼šé€ æˆä¸å¯é€†è½¬çš„æŸå®³
- **éšå½¢çš„**ï¼šå¦‚æœæ²¡æœ‰ä¸“é—¨çš„æ£€æµ‹ï¼Œç”¨æˆ·æ— æ³•åŒºåˆ† hallucination å’Œå‡†ç¡®çš„å“åº”

**æŒ‰é¢†åŸŸåˆ’åˆ†çš„è¡Œä¸šå½±å“ï¼š**

| é¢†åŸŸ | hallucination é£é™©å®¹å¿åº¦ | å…¸å‹çš„ç¼“è§£æ–¹æ³• |
|--------|------------------------------|----------------------------|
| åŒ»ç–—ä¿å¥ | æ¥è¿‘äºé›¶ï¼ˆç”Ÿå‘½è‡³å…³é‡è¦ï¼‰ | å¼ºåˆ¶äººå·¥éªŒè¯ã€è´£ä»»æ‹…å¿§ |
| é‡‘èæœåŠ¡ | æä½ï¼ˆç›‘ç®¡ï¼‰ | åˆè§„é©±åŠ¨çš„å®¡æŸ¥æµç¨‹ |
| æ³•å¾‹ | æä½ï¼ˆè´£ä»»ï¼‰ | ä»…é™äºå†…éƒ¨ç ”ç©¶å’Œèµ·è‰ |
| å®¢æˆ·æ”¯æŒ | ä¸­ç­‰ | å¯¹ä¸ç¡®å®šå“åº”çš„å‡çº§åè®® |
| åˆ›æ„/è¥é”€ | é«˜å®¹å¿åº¦ | éœ€è¦æœ€å°‘çš„å¹²é¢„ |

*æ³¨ï¼šåŸºäºè¡Œä¸šè°ƒæŸ¥ä¸­è§‚å¯Ÿåˆ°çš„ä¼ä¸šéƒ¨ç½²æ¨¡å¼ï¼ˆéº¦è‚¯é”¡ 2024ã€é«˜å¾·çº³ 2024ã€Menlo Ventures 2024ï¼‰ã€‚*

### 1.2 ä¸ºä»€ä¹ˆç°æœ‰è§£å†³æ–¹æ¡ˆä¸è¶³

ç›®å‰çš„ hallucination ç¼“è§£æ–¹æ³•åœ¨ AI å †æ ˆçš„é”™è¯¯å±‚çº§è¿è¡Œï¼š

```mermaid
flowchart TB
    subgraph "å½“å‰æ–¹æ³•ï¼ˆç¢ç‰‡åŒ–ï¼‰"
        direction TB
        A[RAG/Grounding] -->|ç”Ÿæˆå‰| B[å‡å°‘ä½†ä¸èƒ½æ¶ˆé™¤]
        C[fine-tuning] -->|è®­ç»ƒæ—¶é—´| D[æ˜‚è´µä¸”ç‰¹å®šäºæ¨¡å‹]
        E[prompt å·¥ç¨‹] -->|æ¯ä¸ªåº”ç”¨ç¨‹åº| F[ä¸ä¸€è‡´ï¼Œæ— ä¿è¯]
        G[ç¦»çº¿è¯„ä¼°] -->|äº‹å| H[æ— æ³•é˜²æ­¢å®æ—¶ä¼¤å®³]
    end

    subgraph "å·®è·"
        I[âŒ inference æ—¶æ²¡æœ‰å®æ—¶æ£€æµ‹]
        J[âŒ æ²¡æœ‰é›†ä¸­æ§åˆ¶ç‚¹]
        K[âŒ æ²¡æœ‰æˆæœ¬æ„ŸçŸ¥çš„ç¼“è§£é€‰é¡¹]
    end
```

### 1.3 ä¸ºä»€ä¹ˆ vLLM Semantic Router æ˜¯ç†æƒ³çš„è§£å†³æ–¹æ¡ˆç‚¹

vLLM Semantic Router åœ¨ AI åŸºç¡€è®¾æ–½å †æ ˆä¸­å¤„äºç‹¬ç‰¹çš„ä½ç½®ï¼Œä½¿å…¶éå¸¸é€‚åˆ hallucination ç¼“è§£ï¼š

```mermaid
flowchart LR
    subgraph "å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº"
        APP1[App 1]
        APP2[App 2]
        APP3[App N]
    end

    subgraph "vLLM Semantic Router"
        direction TB
        GW[ç»Ÿä¸€ç½‘å…³]

        subgraph "ç°æœ‰èƒ½åŠ›"
            SEC[å®‰å…¨å±‚<br/>pii, jailbreak]
            ROUTE[æ™ºèƒ½è·¯ç”±<br/>æ¨¡å‹é€‰æ‹©]
            CACHE[semantic-cache<br/>æˆæœ¬ä¼˜åŒ–]
        end

        subgraph "æ–°å¢ï¼šTruthLens"
            HALL[hallucination<br/>æ£€æµ‹ä¸ç¼“è§£]
        end
    end

    subgraph "LLM åç«¯"
        LLM1[GPT-4]
        LLM2[Claude]
        LLM3[Llama]
        LLM4[Mistral]
    end

    APP1 --> GW
    APP2 --> GW
    APP3 --> GW

    GW --> SEC
    SEC --> ROUTE
    ROUTE --> CACHE
    CACHE --> HALL

    HALL --> LLM1
    HALL --> LLM2
    HALL --> LLM3
    HALL --> LLM4
```

**ç½‘å…³çº§ hallucination æ§åˆ¶çš„å…³é”®ä¼˜åŠ¿ï¼š**

| ä¼˜åŠ¿ | æè¿° |
|-----------|-------------|
| **æ¨¡å‹æ— å…³** | é€‚ç”¨äºä»»ä½• LLM åç«¯ï¼Œæ— éœ€ä¿®æ”¹ |
| **é›†ä¸­ç­–ç•¥** | æ‰€æœ‰åº”ç”¨ç¨‹åºçš„å•ä¸€é…ç½®ç‚¹ |
| **æˆæœ¬æ§åˆ¶** | å…¨ç»„ç»‡èŒƒå›´å†…å¯¹å‡†ç¡®ç‡ä¸æˆæœ¬æƒè¡¡çš„å¯è§†åŒ– |
| **å¢é‡é‡‡ç”¨** | å¯ç”¨æŒ‰å†³ç­–ã€æŒ‰é¢†åŸŸçš„ç­–ç•¥ |
| **å¯è§‚æµ‹æ€§** | é’ˆå¯¹ hallucination äº‹ä»¶çš„ç»Ÿä¸€æŒ‡æ ‡ã€æ—¥å¿—å’Œè­¦æŠ¥ |
| **æ·±åº¦é˜²å¾¡** | è¡¥å……ï¼ˆè€Œéå–ä»£ï¼‰RAG å’Œ prompt å·¥ç¨‹ |

### 1.4 æ­£å¼é—®é¢˜å®šä¹‰

æˆ‘ä»¬å°†æ£€ç´¢å¢å¼ºç”Ÿæˆ (RAG) ç³»ç»Ÿä¸­çš„ hallucination æ£€æµ‹å½¢å¼åŒ–ä¸º **token çº§åºåˆ—æ ‡æ³¨**é—®é¢˜ã€‚

**å®šä¹‰ 1 (RAG ä¸Šä¸‹æ–‡)ã€‚** è®¾ RAG äº¤äº’å®šä¹‰ä¸ºå…ƒç»„ *(C, Q, R)*ï¼Œå…¶ä¸­ï¼š

- *C = \{câ‚, câ‚‚, ..., câ‚˜\}* æ˜¯æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ï¼ˆæ–‡æ¡£/æ®µè½é›†ï¼‰
- *Q* æ˜¯ç”¨æˆ·æŸ¥è¯¢
- *R = (râ‚, râ‚‚, ..., râ‚™)* æ˜¯ä½œä¸º *n* ä¸ª token åºåˆ—ç”Ÿæˆçš„å“åº”

**å®šä¹‰ 2 (Grounded ä¸ hallucination token)ã€‚** å“åº” *R* ä¸­çš„ token *ráµ¢* æ˜¯ï¼š

- **Grounded**ï¼šå¦‚æœåœ¨ *C* ä¸­å­˜åœ¨æ”¯æŒåŒ…å« *ráµ¢* çš„æ–­è¨€çš„è¯æ®
- **hallucination**ï¼šå¦‚æœ *ráµ¢* è´¡çŒ®äºä»¥ä¸‹æ–­è¨€ï¼š
  - (a) ä¸ *C* ä¸­çš„ä¿¡æ¯çŸ›ç›¾ï¼ˆçŸ›ç›¾ hallucinationï¼‰ï¼Œæˆ–
  - (b) æ— æ³•ä» *C* ä¸­éªŒè¯ä¸”ä¸æ˜¯å¸¸è¯†ï¼ˆæ— æ ¹æ® hallucinationï¼‰

**å®šä¹‰ 3 (hallucination æ£€æµ‹å‡½æ•°)ã€‚** æ£€æµ‹ä»»åŠ¡æ˜¯å­¦ä¹ ä¸€ä¸ªå‡½æ•°ï¼š

*f: (C, Q, R) â†’ Y*

å…¶ä¸­ *Y = (yâ‚, yâ‚‚, ..., yâ‚™)* ä¸” *yáµ¢ âˆˆ \{0, 1\}* è¡¨ç¤º token *ráµ¢* æ˜¯å¦ä¸º hallucinationã€‚

**å®šä¹‰ 4 (hallucination åˆ†æ•°)ã€‚** ç»™å®šé¢„æµ‹ *Y* å’Œç½®ä¿¡åº¦åˆ†æ•° *P = (pâ‚, ..., pâ‚™)*ï¼Œå…¶ä¸­ *páµ¢ = P(yáµ¢ = 1)*ï¼Œæˆ‘ä»¬å®šä¹‰ï¼š

- **token çº§åˆ†æ•°**ï¼š*s_token(ráµ¢) = páµ¢*
- **ç‰‡æ®µ (span) çº§åˆ†æ•°**ï¼šå¯¹äºè¿ç»­ç‰‡æ®µ *S = (ráµ¢, ..., râ±¼)*ï¼Œ*s_span(S) = max(páµ¢, ..., pâ±¼)*
- **å“åº”çº§åˆ†æ•°**ï¼šå¯¹äºæ‰€æœ‰æ»¡è¶³ *páµ¢ > Ï„_token* çš„ *i*ï¼Œ*s_response(R) = 1 - âˆ(1 - páµ¢)*

**å®šä¹‰ 5 (ç¼“è§£å†³ç­–)ã€‚** ç»™å®š threshold *Ï„*ï¼Œç³»ç»Ÿé‡‡å–è¡ŒåŠ¨ï¼š

```text
Action(R) =
  é€šè¿‡ (PASS)        å¦‚æœ s_response(R) < Ï„
  ç¼“è§£ (MITIGATE)    å¦‚æœ s_response(R) â‰¥ Ï„
```

---

## 2. ç›¸å…³å·¥ä½œï¼šhallucination ç¼“è§£çš„æœ€å‰æ²¿æŠ€æœ¯

### 2.1 hallucination ç±»å‹çš„åˆ†ç±»

åœ¨å›é¡¾æ£€æµ‹æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å»ºç«‹äº† hallucination ç±»å‹çš„åˆ†ç±»ï¼š

**ç±»å‹ 1ï¼šå†…åœ¨ (Intrinsic) hallucination** â€”â€” ç”Ÿæˆçš„å†…å®¹ä¸æä¾›çš„ä¸Šä¸‹æ–‡çŸ›ç›¾ã€‚

*ç¤ºä¾‹*ï¼šä¸Šä¸‹æ–‡è¯´â€œä¼šè®®åœ¨å‘¨äºŒâ€ã€‚å“åº”è¯´â€œä¼šè®®å®‰æ’åœ¨å‘¨ä¸‰â€ã€‚

**ç±»å‹ 2ï¼šå¤–åœ¨ (Extrinsic) hallucination** â€”â€” ç”Ÿæˆçš„å†…å®¹æ— æ³•ä»ä¸Šä¸‹æ–‡ä¸­éªŒè¯ï¼Œä¸”ä¸æ˜¯å¸¸è¯†ã€‚

*ç¤ºä¾‹*ï¼šä¸Šä¸‹æ–‡è®¨è®ºå…¬å¸çš„ç¬¬ä¸‰å­£åº¦æ”¶ç›Šã€‚å“åº”åŒ…å«äº†éšå¤„éƒ½æœªæåŠçš„ç¬¬å››å­£åº¦é¢„æµ‹ã€‚

**ç±»å‹ 3ï¼šæé€  (Fabrication)** â€”â€” å®Œå…¨è™šæ„çš„å®ä½“ã€å¼•ç”¨æˆ–äº‹å®ã€‚

*ç¤ºä¾‹*ï¼šâ€œæ ¹æ® Smith ç­‰äºº (2023) çš„è¯´æ³•â€¦â€¦â€è€Œå®é™…ä¸Šä¸å­˜åœ¨è¿™æ ·çš„è®ºæ–‡ã€‚

| ç±»å‹ | æ£€æµ‹éš¾åº¦ | ç¼“è§£æ–¹æ³• |
|------|---------------------|---------------------|
| å†…åœ¨ | è¾ƒæ˜“ï¼ˆç›´æ¥çŸ›ç›¾ï¼‰ | ä¸Šä¸‹æ–‡é‡æ–° ground |
| å¤–åœ¨ | ä¸­ç­‰ï¼ˆéœ€è¦çŸ¥è¯†è¾¹ç•Œï¼‰ | ä¸ç¡®å®šæ€§è¡¨è¾¾ |
| æé€  | è¾ƒéš¾ï¼ˆéœ€è¦å¤–éƒ¨éªŒè¯ï¼‰ | äº¤å‰å¼•ç”¨æ£€æŸ¥ |

### 2.2 æ£€æµ‹æ–¹æ³•

| ç±»åˆ« | ä»£è¡¨æ€§å·¥ä½œ | æœºåˆ¶ | å‡†ç¡®ç‡ | å»¶è¿Ÿ | æˆæœ¬ |
|----------|---------------------|-----------|----------|---------|------|
| **åŸºäºç¼–ç å™¨** | LettuceDetect (2025), Luna (2025) | ä½¿ç”¨ ModernBERT/DeBERTa è¿›è¡Œ token åˆ†ç±» | F1: 75-79% | 15-35ms | ä½ |
| **è‡ªæ´½æ€§ (Self-Consistency)** | SelfCheckGPT (2023) | å¤šæ¬¡é‡‡æ · + ä¸€è‡´æ€§æ£€æŸ¥ | å˜åŒ– | Nx åŸºç¡€ | é«˜ |
| **è·¨æ¨¡å‹** | Finch-Zk (2025) | å¤šæ¨¡å‹å“åº”æ¯”è¾ƒ | F1: +6-39% | 2-3x åŸºç¡€ | é«˜ |
| **å†…éƒ¨çŠ¶æ€** | MIND (ACL 2024) | éšè—å±‚æ¿€æ´»åˆ†æ | é«˜ | \&lt;10ms | éœ€è¦ä»ªå™¨åŒ– |

#### 2.2.1 åŸºäºç¼–ç å™¨çš„æ£€æµ‹ï¼ˆæ·±åº¦æ¢ç´¢ï¼‰

**LettuceDetect** (KovÃ¡cs ç­‰äºº, 2025) å°† hallucination æ£€æµ‹æ¡†æ¶åŒ–ä¸º **token çº§åºåˆ—æ ‡æ³¨**ï¼š

- **æ¶æ„**ï¼šå¸¦æœ‰åˆ†ç±»å¤´çš„ ModernBERT-largeï¼ˆ3.95 äº¿å‚æ•°ï¼‰
- **è¾“å…¥**ï¼šè¿æ¥ [ä¸Šä¸‹æ–‡, æŸ¥è¯¢, å“åº”] å¹¶å¸¦æœ‰ç‰¹æ®Š token
- **è¾“å‡º**ï¼šæ¯ä¸ª token çš„ hallucination æ¦‚ç‡
- **è®­ç»ƒ**ï¼šåœ¨ RAGTruth æ•°æ®é›†ï¼ˆ1.8 ä¸‡ä¸ªç¤ºä¾‹ï¼‰ä¸Šè¿›è¡Œ fine-tuning
- **å…³é”®åˆ›æ–°**ï¼šé•¿ä¸Šä¸‹æ–‡å¤„ç†ï¼ˆ8K tokenï¼‰èƒ½å¤ŸåŒ…å«å®Œæ•´çš„ RAG ä¸Šä¸‹æ–‡

**åœ¨ RAGTruth åŸºå‡†æµ‹è¯•ä¸­çš„æ€§èƒ½ï¼š**

| æ¨¡å‹ | token F1 | ç¤ºä¾‹ F1 | å»¶è¿Ÿ |
|-------|----------|------------|---------|
| LettuceDetect-large | 79.22% | 74.8% | ~30ms |
| LettuceDetect-base | 76.5% | 71.2% | ~15ms |
| Luna (DeBERTa) | 73.1% | 68.9% | ~25ms |
| GPT-4 (zero-shot) | 61.2% | 58.4% | ~2s |

**ä¸ºä»€ä¹ˆ TruthLens é€‰æ‹©åŸºäºç¼–ç å™¨**ï¼šé«˜å‡†ç¡®ç‡ã€ä½å»¶è¿Ÿå’Œå›ºå®šæˆæœ¬çš„ç»“åˆä½¿å¾—åŸºäºç¼–ç å™¨çš„æ£€æµ‹æˆä¸ºç½‘å…³çº§éƒ¨ç½²çš„ç†æƒ³é€‰æ‹©ã€‚

#### 2.2.2 è‡ªæ´½æ€§æ–¹æ³•

**SelfCheckGPT** (Manakul ç­‰äºº, 2023) åˆ©ç”¨äº† hallucination åœ¨ä¸åŒæ ·æœ¬ä¸­ä¸ä¸€è‡´çš„è§‚å¯Ÿç»“æœï¼š

- **æœºåˆ¶**ï¼šç”Ÿæˆ N ä¸ªå“åº”ï¼Œè¡¡é‡ä¸€è‡´æ€§
- **ç›´è§‰**ï¼šäº‹å®å†…å®¹æ˜¯å¯é‡å¤çš„ï¼›hallucination åˆ™å„ä¸ç›¸åŒ
- **å±€é™æ€§**ï¼šéœ€è¦ N æ¬¡ LLM è°ƒç”¨ï¼ˆé€šå¸¸ N=5-10ï¼‰

**ç†è®ºåŸºç¡€**ï¼šå¦‚æœ *P(äº‹å®)* å¾ˆé«˜ï¼Œè¯¥äº‹å®ä¼šå‡ºç°åœ¨å¤§å¤šæ•°æ ·æœ¬ä¸­ã€‚å¦‚æœæ¯ä¸ªæ ·æœ¬çš„ *P(hallucination)* è¾ƒä½ï¼Œå®ƒå¾ˆå°‘ä¼šé‡å¤ã€‚

#### 2.2.3 è·¨æ¨¡å‹éªŒè¯

**Finch-Zk** (2025) åˆ©ç”¨äº†æ¨¡å‹å¤šæ ·æ€§ï¼š

- **æœºåˆ¶**ï¼šæ¯”è¾ƒæ¥è‡ªä¸åŒæ¨¡å‹å®¶æ—çš„å“åº”
- **å…³é”®è§è§£**ï¼šä¸åŒçš„æ¨¡å‹ä»¥ä¸åŒçš„æ–¹å¼äº§ç”Ÿ hallucination
- **ç‰‡æ®µçº§çº é”™**ï¼šç”¨ç½®ä¿¡åº¦æ›´é«˜çš„ç‰ˆæœ¬æ›¿æ¢ä¸ä¸€è‡´çš„ç‰‡æ®µ

### 2.3 ç¼“è§£ç­–ç•¥

| ç­–ç•¥ | ä»£è¡¨æ€§å·¥ä½œ | æœºåˆ¶ | æœ‰æ•ˆæ€§ | å¼€é”€ |
|----------|---------------------|-----------|---------------|----------|
| **è‡ªæˆ‘ç»†åŒ– (Self-Refinement)** | Self-Refine (NeurIPS 2023) | è¿­ä»£åé¦ˆå¾ªç¯ | å‡å°‘ 40-60% | 2-4x å»¶è¿Ÿ |
| **éªŒè¯é“¾ (Chain-of-Verification)** | CoVe (ACL 2024) | ç”ŸæˆéªŒè¯é—®é¢˜ | å‡å°‘ 50-70% | 3-5x å»¶è¿Ÿ |
| **å¤šæ™ºèƒ½ä½“è¾©è®º** | MAD (2024) | å¤šä¸ªæ™ºèƒ½ä½“è¾©è®ºå¹¶æ”¶æ•› | å‡å°‘ 60-80% | 5-10x å»¶è¿Ÿ |
| **è·¨æ¨¡å‹çº é”™** | Finch-Zk (2025) | æœ‰é’ˆå¯¹æ€§çš„ç‰‡æ®µæ›¿æ¢ | å‡†ç¡®ç‡æå‡é«˜è¾¾ 9% | 3x å»¶è¿Ÿ |

#### 2.3.1 è‡ªæˆ‘ç»†åŒ–ï¼ˆæ·±åº¦æ¢ç´¢ï¼‰

**Self-Refine** (Madaan ç­‰äºº, NeurIPS 2023) è¯æ˜äº† LLM å¯ä»¥æ”¹è¿›å…¶è‡ªèº«çš„è¾“å‡ºï¼š

```text
å¾ªç¯ï¼š
  1. ç”Ÿæˆåˆå§‹å“åº” Râ‚€
  2. å¯¹ Râ‚€ ç”Ÿæˆåé¦ˆ Fï¼ˆä½¿ç”¨ç›¸åŒæ¨¡å‹ï¼‰
  3. ä½¿ç”¨ F ç”Ÿæˆç»†åŒ–åçš„å“åº” Râ‚
  4. é‡å¤ç›´åˆ°æ”¶æ•›æˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°
```

**å…³é”®å‘ç°**ï¼š

- å½“åé¦ˆæ˜¯**å…·ä½“çš„**ï¼ˆè€Œä¸ä»…ä»…æ˜¯â€œæ”¹è¿›è¿™ä¸ªâ€ï¼‰æ—¶æ•ˆæœæœ€å¥½
- 2-3 æ¬¡è¿­ä»£åæ”¶ç›Šé€’å‡
- è¦æ±‚æ¨¡å‹å…·å¤‡çº æ­£è‡ªèº«æ‰€éœ€çš„çŸ¥è¯†

**å¯¹ hallucination çš„å±€é™æ€§**ï¼šå¦‚æœæ¨¡å‹ç¼ºä¹æ­£ç¡®çš„çŸ¥è¯†ï¼Œè‡ªæˆ‘ç»†åŒ–å¯èƒ½æ²¡æœ‰å¸®åŠ©ï¼Œç”šè‡³å¯èƒ½å¼•å…¥æ–°çš„é”™è¯¯ã€‚

#### 2.3.2 éªŒè¯é“¾ (CoVe)

**CoVe** (Dhuliawala ç­‰äºº, ACL 2024) ç”ŸæˆéªŒè¯é—®é¢˜ï¼š

```text
1. ç”Ÿæˆå“åº” R
2. ä» R ä¸­æå–äº‹å®æ–­è¨€
3. ä¸ºæ¯ä¸ªæ–­è¨€ç”ŸæˆéªŒè¯é—®é¢˜
4. ä½¿ç”¨ä¸Šä¸‹æ–‡å›ç­”éªŒè¯é—®é¢˜
5. æ ¹æ®éªŒè¯ç»“æœä¿®è®¢ R
```

**ä¼˜ç‚¹**ï¼šæ˜¾å¼çš„éªŒè¯æ­¥éª¤å¯ä»¥æ•æ‰åˆ°ç»†å¾®çš„é”™è¯¯ã€‚
**ç¼ºç‚¹**ï¼šç”±äºå¤šæ­¥éª¤è¿‡ç¨‹ï¼Œå»¶è¿Ÿè¾ƒé«˜ (3-5x)ã€‚

#### 2.3.3 å¤šæ™ºèƒ½ä½“è¾©è®º

**å¤šæ™ºèƒ½ä½“è¾©è®º** (Du ç­‰äºº, 2024) ä½¿ç”¨å¤šä¸ª LLM å®ä¾‹ï¼š

```text
1. å¤šä¸ªæ™ºèƒ½ä½“ç”Ÿæˆå“åº”
2. æ™ºèƒ½ä½“ç›¸äº’è¯„ä»·å¯¹æ–¹çš„å“åº”
3. æ™ºèƒ½ä½“æ ¹æ®è¯„ä»·è¿›è¡Œä¿®è®¢
4. é‡å¤ N è½®
5. ç»¼åˆæœ€ç»ˆå“åº”
```

**ç†è®ºä¼˜åŠ¿**ï¼šå¤šå…ƒåŒ–çš„è§†è§’å¯ä»¥æ•æ‰åˆ°ç›²ç‚¹ã€‚
**å®é™…æŒ‘æˆ˜**ï¼šé«˜æˆæœ¬ (5-10x) å’Œé«˜å»¶è¿Ÿã€‚

### 2.3 å‡†ç¡®ç‡-å»¶è¿Ÿ-æˆæœ¬ä¸‰è§’å½¢

ç ”ç©¶ä¸€è‡´è¡¨æ˜å­˜åœ¨ä¸€ä¸ªåŸºæœ¬çš„æƒè¡¡ï¼š

```mermaid
graph TD
    subgraph "æƒè¡¡ä¸‰è§’å½¢"
        ACC[ğŸ¯ å‡†ç¡®ç‡]
        LAT[âš¡ å»¶è¿Ÿ]
        COST[ğŸ’° æˆæœ¬]

        ACC ---|æƒè¡¡| LAT
        LAT ---|æƒè¡¡| COST
        COST ---|æƒè¡¡| ACC
    end

    subgraph "ç­–ç•¥å®šä½"
        L[è½»é‡çº§æ¨¡å¼<br/>âš¡ğŸ’° å¿«é€Ÿä¸”ä¾¿å®œ<br/>ğŸ¯ ä¸­ç­‰å‡†ç¡®ç‡]
        S[æ ‡å‡†æ¨¡å¼<br/>âš¡ğŸ¯ å¹³è¡¡<br/>ğŸ’° ä¸­ç­‰æˆæœ¬]
        P[é«˜çº§æ¨¡å¼<br/>ğŸ¯ğŸ’° é«˜å‡†ç¡®ç‡<br/>âš¡ æ›´é«˜å»¶è¿Ÿ]
    end

    L --> LAT
    L --> COST
    S --> ACC
    S --> LAT
    P --> ACC
```

**å…³é”®è§è§£**ï¼šæ²¡æœ‰ä»»ä½•ä¸€ç§æ–¹æ³•èƒ½åŒæ—¶ä¼˜åŒ–è¿™ä¸‰ä¸ªç»´åº¦ã€‚TruthLens é€šè¿‡æä¾›**ç”¨æˆ·å¯é€‰æ‹©çš„æ“ä½œæ¨¡å¼**æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®©ç»„ç»‡åœ¨è¿™ä¸€æƒè¡¡ä¸‰è§’å½¢ä¸­é€‰æ‹©è‡ªå·±çš„ä½ç½®ã€‚

---

## 3. ç†è®ºåŸºç¡€

æœ¬èŠ‚å»ºç«‹äº† TruthLens ä¸‰æ¨¡å¼æ¶æ„çš„ç†è®ºåŸºç¡€ï¼Œå€Ÿé‰´äº†åºåˆ—æ ‡æ³¨ã€è¿­ä»£ä¼˜åŒ–ã€é›†æˆå­¦ä¹ å’Œå¤šæ™ºèƒ½ä½“ç³»ç»Ÿç†è®ºã€‚

### 3.1 ä½œä¸ºåºåˆ—æ ‡æ³¨çš„ hallucination æ£€æµ‹

#### 3.1.1 token åˆ†ç±»æ¶æ„

ç°ä»£ hallucination æ£€æµ‹åˆ©ç”¨é’ˆå¯¹ token åˆ†ç±»è¿›è¡Œäº† fine-tuning çš„åŸºäº transformer çš„ç¼–ç å™¨ã€‚ç»™å®šè¾“å…¥åºåˆ— *X = [CLS] C [SEP] Q [SEP] R [SEP]*ï¼Œç¼–ç å™¨äº§ç”Ÿä¸Šä¸‹æ–‡è¡¨ç¤ºï¼š

*H = Encoder(X) âˆˆ â„^(LÃ—d)*

å…¶ä¸­ *L* æ˜¯åºåˆ—é•¿åº¦ï¼Œ*d* æ˜¯éšè—ç»´åº¦ã€‚å¯¹äºå“åº”ä¸­çš„æ¯ä¸ª token *ráµ¢*ï¼Œæˆ‘ä»¬è®¡ç®—ï¼š

*P(yáµ¢ = 1|X) = Ïƒ(W Â· háµ¢ + b)*

å…¶ä¸­ *W âˆˆ â„^d*, *b âˆˆ â„* æ˜¯å­¦ä¹ åˆ°çš„å‚æ•°ï¼Œ*Ïƒ* æ˜¯ sigmoid å‡½æ•°ã€‚

#### 3.1.2 ä¸ºä»€ä¹ˆé€‰æ‹© ModernBERT è¿›è¡Œæ£€æµ‹

ç¼–ç å™¨æ¶æ„çš„é€‰æ‹©ä¼šæ˜¾è‘—å½±å“æ£€æµ‹è´¨é‡ã€‚æˆ‘ä»¬é‡‡ç”¨ ModernBERT (Warner ç­‰äºº, 2024) æ˜¯å› ä¸ºå®ƒå…·æœ‰ä»¥ä¸‹ç†è®ºä¼˜åŠ¿ï¼š

| å±æ€§ | ModernBERT | ä¼ ç»Ÿ BERT | å¯¹æ£€æµ‹çš„å½±å“ |
|----------|------------|------------------|---------------------|
| **ä¸Šä¸‹æ–‡é•¿åº¦** | 8,192 token | 512 token | æ— éœ€æˆªæ–­å³å¯å¤„ç†å®Œæ•´çš„ RAG ä¸Šä¸‹æ–‡ |
| **æ³¨æ„åŠ›æœºåˆ¶** | æ—‹è½¬ä½ç½®åµŒå…¥ (RoPE) | ç»å¯¹ä½ç½® | æ›´å¥½çš„é•¿ç¨‹ä¾èµ–å»ºæ¨¡ |
| **æ¶æ„** | GeGLU æ¿€æ´»ï¼Œæ—  bias | GELUï¼Œæœ‰ bias | æ”¹è¿›äº†ç»†ç²’åº¦åˆ†ç±»çš„æ¢¯åº¦æµ |
| **æ•ˆç‡** | Flash Attention, Unpadding | æ ‡å‡†æ³¨æ„åŠ› | 2x inference åŠ é€Ÿï¼Œå®ç°å®æ—¶æ£€æµ‹ |

#### 3.1.3 è¯„åˆ†å‡½æ•°è®¾è®¡

ä» token çº§åˆ°å“åº”çº§åˆ†æ•°çš„èšåˆéœ€è¦ä»”ç»†è®¾è®¡ã€‚æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ª **Noisy-OR** èšåˆæ¨¡å‹ï¼š

*s_response(R) = 1 - âˆáµ¢(1 - páµ¢ Â· ğŸ™[páµ¢ > Ï„_token])*

**ç†è®ºä¾æ®**ï¼šNoisy-OR æ¨¡å‹å‡è®¾ä¸åŒ token å¤„çš„ hallucination äº‹ä»¶ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚è™½ç„¶è¿™æ˜¯ä¸€ä¸ªè¿‘ä¼¼ï¼Œä½†å®ƒæä¾›äº†ï¼š

1. **å•è°ƒæ€§**ï¼šå¢åŠ ä¸€ä¸ª hallucination token ç»ä¸ä¼šé™ä½å“åº”åˆ†æ•°
2. **æ•æ„Ÿæ€§**ï¼šå•ä¸ªé«˜ç½®ä¿¡åº¦çš„ hallucination å°±ä¼šè§¦å‘æ£€æµ‹
3. **æ ¡å‡†**ï¼šåˆ†æ•°è¿‘ä¼¼äº *P(R ä¸­å­˜åœ¨ hallucination)*

**æ›¿ä»£æ–¹æ¡ˆï¼šåŸºäºç‰‡æ®µ (Span) çš„èšåˆ**

å¯¹äºç›¸å…³çš„ hallucinationï¼ˆåœ¨æé€ å®ä½“ä¸­å¾ˆå¸¸è§ï¼‰ï¼Œæˆ‘ä»¬é¦–å…ˆå°†è¿ç»­çš„ hallucination token åˆ†ç»„ä¸ºç‰‡æ®µï¼Œç„¶åè¿›è¡Œèšåˆï¼š

*s_response(R) = max\{s_span(Sâ‚), s_span(Sâ‚‚), ..., s_span(Sâ‚–)\}*

è¿™å‡å°‘äº†å¯¹åˆ†è¯ (tokenization) äººä¸ºå› ç´ çš„æ•æ„Ÿæ€§ï¼Œå¹¶ä¸“æ³¨äºè¯­ä¹‰å•å…ƒã€‚

#### 3.1.4 threshold é€‰æ‹©ç†è®º

æ£€æµ‹ threshold *Ï„* æ§åˆ¶ç€ç²¾ç¡®ç‡ä¸å¬å›ç‡çš„æƒè¡¡ã€‚æ ¹æ®å†³ç­–ç†è®ºï¼š

**å‘½é¢˜ 1 (æœ€ä¼˜ threshold)ã€‚** *ç»™å®šæˆæœ¬æ¯” Î» = C_FN / C_FPï¼ˆå‡é˜´æ€§ä¸å‡é˜³æ€§çš„æˆæœ¬æ¯”ï¼‰ï¼Œæœ€ä¼˜ threshold æ»¡è¶³ï¼š*

*Ï„* = 1 / (1 + Î» Â· (1-Ï€)/Ï€)*

*å…¶ä¸­ Ï€ æ˜¯ hallucination çš„å…ˆéªŒæ¦‚ç‡ã€‚*

**å®é™…æ„ä¹‰ï¼š**

| é¢†åŸŸ | Î» (æˆæœ¬æ¯”) | æ¨èçš„ Ï„ | ç†ç”± |
|--------|----------------|---------------|-----------|
| åŒ»ç–— | 10-100 | 0.3-0.5 | é—æ¼ hallucination æ˜¯ç¾éš¾æ€§çš„ |
| é‡‘è | 5-20 | 0.4-0.6 | è™šå‡ä¿¡æ¯å¸¦æ¥çš„ç›‘ç®¡é£é™© |
| å®¢æˆ·æ”¯æŒ | 1-2 | 0.6-0.7 | å¹³è¡¡ç”¨æˆ·ä½“éªŒå’Œå‡†ç¡®ç‡ |
| åˆ›æ„ | 0.1-0.5 | 0.8-0.9 | è¿‡åº¦æ ‡è®°ä¼šæŸå®³åˆ›é€ åŠ› |

### 3.2 è‡ªæˆ‘ç»†åŒ–ç†è®º

#### 3.2.1 ä½œä¸ºä¸åŠ¨ç‚¹è¿­ä»£çš„è¿­ä»£ç»†åŒ–

æ ‡å‡†æ¨¡å¼é‡‡ç”¨è¿­ä»£è‡ªæˆ‘ç»†åŒ–ï¼Œè¿™å¯ä»¥å½¢å¼åŒ–ä¸ºå¯»æ‰¾ç»†åŒ–ç®—å­çš„ä¸åŠ¨ç‚¹ã€‚

**å®šä¹‰ 6 (ç»†åŒ–ç®—å­)ã€‚** è®¾ *T: R â†’ R* ä¸ºç»†åŒ–ç®—å­ï¼Œå…¶ä¸­ï¼š

*T(Râ‚œ) = LLM(Prompt_refine(C, Q, Râ‚œ, Detect(Râ‚œ)))*

è¿­ä»£è¿‡ç¨‹ä¸ºï¼š*Râ‚€ â†’ Râ‚ â†’ Râ‚‚ â†’ ... â†’ R**

**å®šç† 1 (æ”¶æ•›æ¡ä»¶)ã€‚** *ç»†åŒ–åºåˆ— \{Râ‚œ\} æ”¶æ•›åˆ°ä¸åŠ¨ç‚¹ R\*ï¼Œå¦‚æœï¼š*

1. *hallucination åˆ†æ•°åºåˆ— \{s(Râ‚œ)\} æ˜¯å•è°ƒä¸å¢çš„*
2. *åˆ†æ•°æœ‰ä¸‹ç•Œ (s(R) â‰¥ 0)*
3. *LLM è¡¨ç°å‡ºä¸€è‡´æ€§ï¼šç›¸ä¼¼çš„ prompt äº§ç”Ÿç›¸ä¼¼çš„è¾“å‡º*

**è¯æ˜æ¢—æ¦‚**ï¼šæ¡ä»¶ 1 å’Œ 2 ç¡®ä¿åˆ†æ•°åºåˆ—æ ¹æ®å•è°ƒæ”¶æ•›å®šç†æ”¶æ•›ã€‚æ¡ä»¶ 3 (LLM ä¸€è‡´æ€§) ç¡®ä¿å“åº”åºåˆ—æœ¬èº«æ”¶æ•›ï¼Œè€Œä¸ä»…ä»…æ˜¯åˆ†æ•°ã€‚

#### 3.2.2 æ”¶æ•›é€Ÿåº¦åˆ†æ

**ç»éªŒè§‚å¯Ÿ**ï¼šè‡ªæˆ‘ç»†åŒ–é€šå¸¸è¡¨ç°å‡º**æ¬¡çº¿æ€§æ”¶æ•›**ï¼š

*s(Râ‚œ) - s(R*) â‰¤ O(1/t)*

è¿™æ˜¯å› ä¸ºï¼š

1. **å®¹æ˜“çš„ hallucination**ï¼ˆæ˜¾å¼çŸ›ç›¾ï¼‰åœ¨æ—©æœŸè¿­ä»£ä¸­è¢«çº æ­£
2. **å›°éš¾çš„ hallucination**ï¼ˆå¾®å¦™çš„æ— æ ¹æ®æ–­è¨€ï¼‰å¯èƒ½ä¼šæŒç»­å­˜åœ¨æˆ–éœ‡è¡
3. å®è·µä¸­ 2-3 æ¬¡è¿­ä»£å**æ”¶ç›Šé€’å‡**

```mermaid
graph LR
    subgraph "æ”¶æ•›æ¨¡å¼"
        R0[Râ‚€<br/>s=0.8] -->|è¿­ä»£ 1| R1[Râ‚<br/>s=0.5]
        R1 -->|è¿­ä»£ 2| R2[Râ‚‚<br/>s=0.35]
        R2 -->|è¿­ä»£ 3| R3[Râ‚ƒ<br/>s=0.3]
        R3 -.->|æ”¶ç›Šé€’å‡| R4[Râ‚„<br/>s=0.28]
    end
```

#### 3.2.3 çº é”™çš„ prompt å·¥ç¨‹åŸåˆ™

æœ‰æ•ˆçš„ç»†åŒ– prompt å¿…é¡»æ»¡è¶³å‡ ä¸ªç†è®ºç‰¹æ€§ï¼š

**åŸåˆ™ 1 (ç‰¹å¼‚æ€§)**ï¼šprompt å¿…é¡»è¯†åˆ«å‡º*å“ªäº›*ç‰‡æ®µäº§ç”Ÿäº† hallucinationï¼Œè€Œä¸ä»…ä»…æ˜¯æŒ‡å‡ºå­˜åœ¨ hallucinationã€‚

**åŸåˆ™ 2 (Grounding)**ï¼šprompt å¿…é¡»æä¾›åŸå§‹ä¸Šä¸‹æ–‡ *C* ä»¥å¯ç”¨äº‹å®æ ¸æŸ¥ã€‚

**åŸåˆ™ 3 (ä¿ç•™)**ï¼šprompt å¿…é¡»æŒ‡ç¤ºæ¨¡å‹ä¿ç•™å‡†ç¡®çš„å†…å®¹ã€‚

**åŸåˆ™ 4 (ä¸ç¡®å®šæ€§)**ï¼šå½“æ— æ³•çº æ­£æ—¶ï¼Œæ¨¡å‹åº”è¯¥è¡¨è¾¾ä¸ç¡®å®šæ€§ï¼Œè€Œä¸æ˜¯æé€ æ›¿ä»£æ–¹æ¡ˆã€‚

**ç»†åŒ– prompt æ¨¡æ¿ç»“æ„ï¼š**

```text
ç»™å®šï¼š
- ä¸Šä¸‹æ–‡ï¼š[æ£€ç´¢åˆ°çš„æ®µè½ C]
- æŸ¥è¯¢ï¼š[ç”¨æˆ·é—®é¢˜ Q]
- å“åº”ï¼š[å¸¦æœ‰æ ‡æ³¨å‡ºçš„ hallucination ç‰‡æ®µçš„å½“å‰å“åº” Râ‚œ]

ä»¥ä¸‹ç‰‡æ®µå¯èƒ½å­˜åœ¨ hallucinationï¼š[ (ç‰‡æ®µ, ç½®ä¿¡åº¦) åˆ—è¡¨]

æŒ‡ä»¤ï¼š
1. å¯¹äºæ¯ä¸ªæ ‡è®°å‡ºçš„ç‰‡æ®µï¼Œæ ¹æ®ä¸Šä¸‹æ–‡è¿›è¡ŒéªŒè¯
2. å¦‚æœå­˜åœ¨çŸ›ç›¾ï¼šä½¿ç”¨ä¸Šä¸‹æ–‡è¯æ®è¿›è¡Œçº æ­£
3. å¦‚æœæ— æ³•éªŒè¯ä¸”ä¸æ˜¯å¸¸è¯†ï¼šåˆ é™¤æˆ–ä½¿ç”¨ä¸ç¡®å®šæ€§è¯æ±‡ä¿®é¥°
4. ä¿ç•™æ‰€æœ‰å‡†ç¡®ä¸” grounded çš„å†…å®¹
5. ä¿æŒè¿è´¯çš„å™äº‹æµ
```

### 3.3 å¤šæ¨¡å‹åä½œç†è®º

é«˜çº§æ¨¡å¼åˆ©ç”¨å¤šä¸ª LLM è¿›è¡Œäº¤å‰éªŒè¯ã€‚æˆ‘ä»¬å°†æ­¤å»ºç«‹åœ¨é›†æˆå­¦ä¹ å’Œå¤šæ™ºèƒ½ä½“è¾©è®ºç†è®ºçš„åŸºç¡€ä¸Šã€‚

#### 3.3.1 é›†æˆå­¦ä¹ è§†è§’

**å®šç† 2 (å¤šæ ·æ€§-å‡†ç¡®ç‡æƒè¡¡)ã€‚** *å¯¹äºä¸€ä¸ªç”± M ä¸ªæ¨¡å‹ç»„æˆçš„é›†æˆï¼Œå…¶ä¸ªä½“é”™è¯¯ç‡ä¸º Îµï¼Œä¸¤ä¸¤ç›¸å…³æ€§ä¸º Ïï¼Œåœ¨å¤šæ•°æŠ•ç¥¨ä¸‹çš„é›†æˆé”™è¯¯ç‡ä¸ºï¼š*

*Îµ_ensemble â‰ˆ Îµ Â· (1 + (M-1)Ï) / M*    *å½“ Îµ < 0.5 æ—¶*

**æ¨è®º**ï¼šåªæœ‰å½“ Ï < 1ï¼ˆæ¨¡å‹æ˜¯å¤šæ ·åŒ–çš„ï¼‰æ—¶ï¼Œé›†æˆé”™è¯¯ç‡æ‰ä¼šéšç€ M â†’ âˆ è¶‹äºé›¶ã€‚

**å¯¹ TruthLens çš„å¯ç¤ºï¼š**

| æ¨¡å‹ç»„åˆ | é¢„æœŸå¤šæ ·æ€§ (1-Ï) | é”™è¯¯å‡å°‘ |
|-------------------|--------------------------|-----------------|
| ç›¸åŒæ¨¡å‹å®¶æ— (GPT-4 å˜ä½“) | ä½ (0.2-0.4) | 10-20% |
| ä¸åŒå®¶æ— (GPT-4 + Claude) | ä¸­ (0.4-0.6) | 30-50% |
| ä¸åŒæ¶æ„ (Transformer + å…¶ä»–) | é«˜ (0.6-0.8) | 50-70% |

#### 3.3.2 å¤šæ™ºèƒ½ä½“è¾©è®ºæ¡†æ¶

é™¤äº†ç®€å•çš„æŠ•ç¥¨ï¼Œå¤šæ™ºèƒ½ä½“è¾©è®ºè¿˜å…è®¸æ¨¡å‹å¯¹äº‹å®æ–­è¨€è¿›è¡Œ**è¾©è®º**å¹¶æ”¶æ•›åˆ°çœŸç›¸ã€‚

**å®šä¹‰ 7 (è®ºè¯æ¡†æ¶)ã€‚** ä¸€ä¸ªè®ºè¯æ¡†æ¶æ˜¯ä¸€ä¸ªäºŒå…ƒç»„ *AF = (A, â†’)*ï¼Œå…¶ä¸­ï¼š

- *A* æ˜¯ä¸€ç»„è®ºç‚¹ï¼ˆæ¥è‡ªæ¯ä¸ªæ¨¡å‹çš„äº‹å®æ–­è¨€ï¼‰
- *â†’ âŠ† A Ã— A* æ˜¯ä¸€ä¸ªæ”»å‡»å…³ç³»ï¼ˆè®ºç‚¹ä¹‹é—´çš„çŸ›ç›¾ï¼‰

**å®šä¹‰ 8 (Grounded æ‰©å±•)ã€‚** AF çš„ grounded æ‰©å±• *E* æ˜¯æœ€å¤§çš„æ— å†²çªè®ºç‚¹é›†ï¼Œå®ƒèƒ½æŠµå¾¡æ‰€æœ‰æ”»å‡»ã€‚

**å¤šæ™ºèƒ½ä½“è¾©è®ºåè®®ï¼š**

```mermaid
sequenceDiagram
    participant Q as æŸ¥è¯¢
    participant M1 as æ¨¡å‹ A<br/>(æ”¯æŒè€…)
    participant M2 as æ¨¡å‹ B<br/>(æ‰¹è¯„è€…)
    participant J as è£åˆ¤æ¨¡å‹

    Q->>M1: ç”Ÿæˆå“åº” Râ‚
    Q->>M2: ç”Ÿæˆå“åº” Râ‚‚

    M1->>M2: "æ–­è¨€ X å¾—åˆ°ä¸Šä¸‹æ–‡æ®µè½ P çš„æ”¯æŒ"
    M2->>M1: "æ–­è¨€ X ä¸æ®µè½ Q çŸ›ç›¾"

    loop è¾©è®ºè½®æ¬¡ (æœ€å¤š 3 è½®)
        M1->>M2: ä½¿ç”¨è¯æ®ç»†åŒ–è®ºç‚¹
        M2->>M1: åé©³è®ºç‚¹æˆ–è®©æ­¥
    end

    M1->>J: æœ€ç»ˆç«‹åœº + è¯æ®
    M2->>J: æœ€ç»ˆç«‹åœº + è¯æ®
    J->>Q: ç»¼åˆå“åº” (grounded æ‰©å±•)
```

#### 3.3.3 å…±è¯†æœºåˆ¶

**æœºåˆ¶ 1ï¼šå¤šæ•°æŠ•ç¥¨**

*y_final(token) = argmax_y |\{m : f_m(token) = y\}|*

- ç®€å•ã€å¿«é€Ÿ
- éœ€è¦å¥‡æ•°ä¸ªæ¨¡å‹
- æœªè€ƒè™‘æ¨¡å‹ç½®ä¿¡åº¦

**æœºåˆ¶ 2ï¼šåŠ æƒç½®ä¿¡åº¦èšåˆ**

*p_final(token) = Î£â‚˜ wâ‚˜ Â· pâ‚˜(token) / Î£â‚˜ wâ‚˜*

å…¶ä¸­ *wâ‚˜* æ˜¯æ¨¡å‹ m ç»è¿‡æ ¡å‡†çš„å¯é æ€§æƒé‡ã€‚

- è€ƒè™‘äº†ä¸åŒçš„æ¨¡å‹ä¸“ä¸šçŸ¥è¯†
- éœ€è¦æ ¡å‡†åçš„ç½®ä¿¡åº¦åˆ†æ•°

**æœºåˆ¶ 3ï¼šç‰‡æ®µçº§æ›¿æ¢ (Finch-Zk)**

å¯¹äºå“åº” *Râ‚* ä¸­çš„æ¯ä¸ªæ–­è¨€ç‰‡æ®µ *S*ï¼š

1. å°† Râ‚ åˆ†å‰²ä¸ºæ–­è¨€ \{Sâ‚, Sâ‚‚, ..., Sâ‚–\}
2. å¯¹äºæ¯ä¸ª Sáµ¢ï¼Œæ£€æŸ¥ä¸ Râ‚‚ çš„ä¸€è‡´æ€§
3. å¦‚æœä¸ä¸€è‡´ï¼šç”¨æ›´å¯é æ¨¡å‹çš„ç‰ˆæœ¬æ›¿æ¢ Sáµ¢
4. è¾“å‡ºï¼šå…·æœ‰æœ€é«˜ç½®ä¿¡åº¦ç‰‡æ®µçš„æ··åˆå“åº”

#### 5.5.5 å‡†ç¡®ç‡-æˆæœ¬æƒè¡¡åˆ†æ

| é…ç½® | æ¨¡å‹ | é¢„æœŸå‡†ç¡®ç‡æå‡ | æˆæœ¬å€æ•° |
|---------------|--------|----------------------|-----------------|
| åŒæ¨¡å‹æŠ•ç¥¨ | 2 | +15-25% | 2x |
| ä¸‰æ¨¡å‹æŠ•ç¥¨ | 3 | +25-35% | 3x |
| åŒæ¨¡å‹ + è£åˆ¤ | 2+1 | +30-40% | 3x |
| å…¨é¢è¾©è®º (3 è½®) | 2+1 | +40-50% | 5-6x |

#### 5.5.6 ç†æƒ³ç”¨ä¾‹

- **åŒ»ç–—è¯Šæ–­è¾…åŠ©**ï¼šç”Ÿå‘½æ”¸å…³çš„å†³ç­–
- **æ³•å¾‹æ–‡ä»¶åˆ†æ**ï¼šæ³•å¾‹è´£ä»»å½±å“
- **è´¢åŠ¡é¡¾é—®**ï¼šéœ€è¦åˆè§„æ€§
- **å®‰å…¨å…³é”®ç³»ç»Ÿ**ï¼šèˆªç©ºèˆªå¤©ã€æ ¸èƒ½ç­‰

### 5.6 æ¨¡å¼é€‰æ‹©å†³ç­–æ ‘

```mermaid
flowchart TD
    START[æ–°åº”ç”¨ç¨‹åº] --> Q1{ç›‘ç®¡<br/>è¦æ±‚ï¼Ÿ}

    Q1 -->|åŒ»ç–—/é‡‘è/æ³•å¾‹| P[ğŸ”´ é«˜çº§æ¨¡å¼]
    Q1 -->|æ— /ä½| Q2{é”™è¯¯çš„<br/>ç”¨æˆ·å½±å“ï¼Ÿ}

    Q2 -->|é«˜| Q3{é¢„ç®—<br/>çº¦æŸï¼Ÿ}
    Q2 -->|ä½| L[ğŸŸ¢ è½»é‡çº§æ¨¡å¼]

    Q3 -->|çµæ´»| S[ğŸŸ¡ æ ‡å‡†æ¨¡å¼]
    Q3 -->|ç´§å¼ | Q4{ç”¨æˆ·èƒ½å¦<br/>éªŒè¯ï¼Ÿ}

    Q4 -->|æ˜¯| L
    Q4 -->|å¦| S

    P --> CONFIG_P[é…ç½®ï¼š<br/>â€¢ å¤šæ¨¡å‹åç«¯<br/>â€¢ æœ€å¤§è¿­ä»£ï¼š5-10<br/>â€¢ Thresholdï¼š0.3-0.5]

    S --> CONFIG_S[é…ç½®ï¼š<br/>â€¢ è‡ªæˆ‘ç»†åŒ–<br/>â€¢ æœ€å¤§è¿­ä»£ï¼š3-5<br/>â€¢ Thresholdï¼š0.5-0.7]

    L --> CONFIG_L[é…ç½®ï¼š<br/>â€¢ è­¦å‘Šæ¨¡æ¿<br/>â€¢ Thresholdï¼š0.6-0.8<br/>â€¢ å…ƒæ•°æ® Header]
```

---

## 6. é…ç½®è®¾è®¡

### 6.1 å…¨å±€é…ç½®

```yaml
# å…¨å±€ hallucination æ£€æµ‹è®¾ç½®
hallucination:
  enabled: true

  # æ£€æµ‹æ¨¡å‹ï¼ˆåŸºäº ModernBERTï¼‰
  model_id: "models/lettucedetect-large-modernbert-en-v1"
  use_cpu: false

  # é»˜è®¤æ“ä½œæ¨¡å¼
  default_mode: "standard"  # lightweight | standard | premium

  # æ£€æµ‹ threshold (0.0 - 1.0)
  # è¶Šä½ = è¶Šä¸¥æ ¼ï¼Œè¶Šé«˜ = è¶Šå®½æ¾
  threshold: 0.6

  # è½»é‡çº§æ¨¡å¼çš„è­¦å‘Šæ¨¡æ¿
  warning_template: |
    âš ï¸ **æç¤º**ï¼šæ­¤å“åº”å¯èƒ½åŒ…å«æ— æ³•æ ¹æ®æä¾›çš„ä¸Šä¸‹æ–‡å®Œå…¨éªŒè¯çš„ä¿¡æ¯ã€‚
    è¯·åœ¨é‡‡å–è¡ŒåŠ¨å‰éªŒè¯å…³é”®äº‹å®ã€‚

  # æ ‡å‡†æ¨¡å¼è®¾ç½®
  standard:
    max_iterations: 3
    convergence_threshold: 0.4  # å¦‚æœåˆ†æ•°é™è‡³æ­¤å€¼ä»¥ä¸‹åˆ™åœæ­¢

  # é«˜çº§æ¨¡å¼è®¾ç½®
  premium:
    verification_models:
      - "claude-3-sonnet"
      - "gpt-4-turbo"
    judge_model: "llama-3.1-70b"
    max_iterations: 5
    require_consensus: true
```

### 6.2 æŒ‰å†³ç­–çš„æ’ä»¶é…ç½®

```yaml
decisions:
  # åŒ»ç–—é¢†åŸŸ - éœ€è¦æœ€é«˜å‡†ç¡®ç‡
  - name: "medical_assistant"
    description: "åŒ»ç–—ä¿¡æ¯æŸ¥è¯¢"
    priority: 100
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "healthcare"
        - type: "keyword"
          name: "medical_terms"
    modelRefs:
      - model: "gpt-4-turbo"
    plugins:
      - type: "hallucination"
        configuration:
          enabled: true
          mode: "premium"
          threshold: 0.3           # éå¸¸ä¸¥æ ¼
          max_iterations: 5
          require_disclaimer: true

  # é‡‘èæœåŠ¡ - é«˜å‡†ç¡®ç‡
  - name: "financial_advisor"
    description: "è´¢åŠ¡åˆ†æä¸å»ºè®®"
    priority: 90
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "finance"
    plugins:
      - type: "hallucination"
        configuration:
          enabled: true
          mode: "standard"
          threshold: 0.5
          max_iterations: 4

  # é€šç”¨å®¢æˆ·æ”¯æŒ - å¹³è¡¡
  - name: "customer_support"
    description: "é€šç”¨å®¢æˆ·å’¨è¯¢"
    priority: 50
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "support"
    plugins:
      - type: "hallucination"
        configuration:
          enabled: true
          mode: "standard"
          threshold: 0.6
          max_iterations: 2

  # å†…éƒ¨å·¥å…· - æˆæœ¬ä¼˜åŒ–
  - name: "internal_assistant"
    description: "å†…éƒ¨çŸ¥è¯†åº“æŸ¥è¯¢"
    priority: 30
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "internal"
    plugins:
      - type: "hallucination"
        configuration:
          enabled: true
          mode: "lightweight"
          threshold: 0.7

  # åˆ›æ„å†™ä½œ - ç¦ç”¨æ£€æµ‹
  - name: "creative_writing"
    description: "åˆ›æ„å†…å®¹ç”Ÿæˆ"
    priority: 20
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "creative"
    plugins:
      - type: "hallucination"
        configuration:
          enabled: false  # åœ¨æ­¤å¤„ï¼Œ"hallucination" æ˜¯ä¸€é¡¹ç‰¹æ€§
```

### 6.3 å“åº” Header

å½“å¯ç”¨ hallucination æ£€æµ‹æ—¶ï¼Œä»¥ä¸‹ Header ä¼šæ·»åŠ åˆ°æ‰€æœ‰å“åº”ä¸­ï¼š

| Header | æè¿° | ç¤ºä¾‹å€¼ |
|--------|-------------|----------------|
| `X-TruthLens-Enabled` | æ˜¯å¦æ‰§è¡Œäº†æ£€æµ‹ | `true`, `false` |
| `X-TruthLens-Mode` | ä½¿ç”¨çš„æ“ä½œæ¨¡å¼ | `lightweight`, `standard`, `premium` |
| `X-TruthLens-Score` | hallucination ç½®ä¿¡åº¦åˆ†æ•° | `0.0` - `1.0` |
| `X-TruthLens-Detected` | hallucination æ˜¯å¦è¶…è¿‡ threshold | `true`, `false` |
| `X-TruthLens-Iterations` | ç»†åŒ–è¿­ä»£æ¬¡æ•° | `0`, `1`, `2`, ... |
| `X-TruthLens-Latency-Ms` | æ£€æµ‹/ç¼“è§£å»¶è¿Ÿ | `35`, `450`, `2100` |

### 6.4 æŒ‡æ ‡ä¸å¯è§‚æµ‹æ€§

**Prometheus æŒ‡æ ‡ï¼š**

| æŒ‡æ ‡ | ç±»å‹ | æ ‡ç­¾ | æè¿° |
|--------|------|--------|-------------|
| `truthlens_detections_total` | Counter | `decision`, `mode`, `detected` | æ€»æ£€æµ‹æ“ä½œæ•° |
| `truthlens_score` | Histogram | `decision`, `mode` | åˆ†æ•°åˆ†å¸ƒ |
| `truthlens_latency_seconds` | Histogram | `mode`, `operation` | å¤„ç†å»¶è¿Ÿ |
| `truthlens_iterations` | Histogram | `decision`, `mode` | ç»†åŒ–è¿­ä»£æ¬¡æ•° |
| `truthlens_models_used` | Counter | `model`, `role` | é«˜çº§æ¨¡å¼ä¸­ä½¿ç”¨çš„æ¨¡å‹ |

---

## 7. å‚è€ƒæ–‡çŒ®

1. KovÃ¡cs, Ã., & Recski, G. (2025). *LettuceDetect: A Hallucination Detection Framework for RAG Applications*. arXiv:2502.17125

2. Goel, A., Schwartz, D., & Qi, Y. (2025). *Finch-Zk: Zero-knowledge LLM hallucination detection and mitigation through fine-grained cross-model consistency*. arXiv:2508.14314

3. Lin, Z., Niu, Z., Wang, Z., & Xu, Y. (2024). *Interpreting and Mitigating Hallucination in MLLMs through Multi-agent Debate*. arXiv:2407.20505

4. Tran, K.T., et al. (2025). *Multi-Agent Collaboration Mechanisms: A Survey of LLMs*. arXiv:2501.06322

5. Manakul, P., Liusie, A., & Gales, M.J. (2023). *SelfCheckGPT: Zero-Resource Black-Box Hallucination Detection for Generative Large Language Models*. arXiv:2303.08896

6. Tang, L., et al. (2024). *MiniCheck: Efficient Fact-Checking of LLMs on Grounding Documents*. EMNLP 2024

7. Madaan, A., et al. (2023). *Self-Refine: Iterative Refinement with Self-Feedback*. NeurIPS 2023

8. Dhuliawala, S., et al. (2024). *Chain-of-Verification Reduces Hallucination in Large Language Models*. ACL Findings 2024

9. Su, W., et al. (2024). *Unsupervised Real-Time Hallucination Detection based on LLM Internal States (MIND)*. ACL Findings 2024

10. Belyi, M., et al. (2025). *Luna: A Lightweight Evaluation Model to Catch Language Model Hallucinations*. COLING 2025

---

## é™„å½• Aï¼šå®Œæ•´ç³»ç»Ÿæµç¨‹å›¾

```mermaid
flowchart TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        CLIENT[å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº]
    end

    subgraph "ç½‘å…³å±‚"
        ENVOY[Envoy ä»£ç†]
    end

    subgraph "vLLM Semantic Router - ExtProc"
        direction TB

        subgraph "è¯·æ±‚å¤„ç†"
            REQ_H[handleRequestHeaders]
            REQ_B[handleRequestBody]

            subgraph "è¯·æ±‚å®‰å…¨"
                PII_REQ[pii æ£€æµ‹]
                JAIL[jailbreak æ£€æµ‹]
            end

            subgraph "è·¯ç”±"
                CLASS[æ„å›¾åˆ†ç±»]
                DECISION[å†³ç­–å¼•æ“]
                MODEL_SEL[æ¨¡å‹é€‰æ‹©]
            end

            CACHE_CHK[semantic-cache æ£€æŸ¥]
        end

        subgraph "å“åº”å¤„ç†"
            RES_H[handleResponseHeaders]
            RES_B[handleResponseBody]

            subgraph "TruthLens"
                DETECT[hallucination<br/>æ£€æµ‹å™¨]
                SCORE[åˆ†æ•°<br/>è¯„ä¼°]

                subgraph "ç¼“è§£"
                    WARN[è­¦å‘Š<br/>æ³¨å…¥]
                    REFINE[è¿­ä»£<br/>ç»†åŒ–]
                end
            end

            CACHE_UPD[ç¼“å­˜æ›´æ–°]
            METRICS[æŒ‡æ ‡è®°å½•]
        end
    end

    subgraph "åç«¯å±‚"
        VLLM1[vLLM å®ä¾‹ 1]
        VLLM2[vLLM å®ä¾‹ 2]
        VLLMn[vLLM å®ä¾‹ N]
    end

    subgraph "å­˜å‚¨å±‚"
        REDIS[(Redis ç¼“å­˜)]
        MODELS[(æ¨¡å‹æ–‡ä»¶)]
    end

    CLIENT --> ENVOY
    ENVOY <--> REQ_H
    REQ_H --> REQ_B
    REQ_B --> PII_REQ
    PII_REQ --> JAIL
    JAIL --> CLASS
    CLASS --> DECISION
    DECISION --> MODEL_SEL
    MODEL_SEL --> CACHE_CHK

    CACHE_CHK -->|ç¼“å­˜å‘½ä¸­| RES_H
    CACHE_CHK -->|ç¼“å­˜æœªå‘½ä¸­| VLLM1
    CACHE_CHK -->|ç¼“å­˜æœªå‘½ä¸­| VLLM2
    CACHE_CHK -->|ç¼“å­˜æœªå‘½ä¸­| VLLMn

    VLLM1 --> RES_H
    VLLM2 --> RES_H
    VLLMn --> RES_H

    RES_H --> RES_B
    RES_B --> DETECT
    DETECT --> SCORE

    SCORE -->|ä½äº Threshold| CACHE_UPD
    SCORE -->|é«˜äº Threshold| WARN
    SCORE -->|é«˜äº Threshold| REFINE

    WARN --> CACHE_UPD
    REFINE -->|é‡è¯•| VLLM1
    REFINE -->|æ”¶æ•›| CACHE_UPD

    CACHE_UPD --> METRICS
    METRICS --> ENVOY
    ENVOY --> CLIENT

    REDIS <-.-> CACHE_CHK
    REDIS <-.-> CACHE_UPD
    MODELS <-.-> DETECT
```

---

## é™„å½• Bï¼šæœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------------|
| **hallucination** | LLM ç”Ÿæˆçš„äº‹å®é”™è¯¯æˆ–ä¸å—ä¸Šä¸‹æ–‡æ”¯æŒçš„å†…å®¹ |
| **å†…åœ¨ (Intrinsic) hallucination** | æºè‡ªæ¨¡å‹å†…éƒ¨å‚æ•°åŒ–çŸ¥è¯†çš„è™šå‡äº‹å® |
| **å¤–åœ¨ (Extrinsic) hallucination** | æœª grounded åœ¨æ‰€æä¾›ä¸Šä¸‹æ–‡ä¸­çš„å†…å®¹ï¼ˆåœ¨ RAG ä¸­å¸¸è§ï¼‰ |
| **ExtProc** | Envoy å¤–éƒ¨å¤„ç†å™¨ - å…è®¸åœ¨ç½‘å…³å¤„ä¿®æ”¹è¯·æ±‚/å“åº” |
| **token çº§æ£€æµ‹** | è¯†åˆ«äº§ç”Ÿ hallucination çš„ç‰¹å®š token/ç‰‡æ®µ |
| **è‡ªæˆ‘ç»†åŒ– (Self-Refinement)** | ç›¸åŒæ¨¡å‹çº æ­£è‡ªèº«äº§ç”Ÿçš„ hallucination çš„è¿­ä»£è¿‡ç¨‹ |
| **è·¨æ¨¡å‹éªŒè¯** | ä½¿ç”¨å¤šä¸ªä¸åŒçš„æ¨¡å‹æ¥éªŒè¯äº‹å®ä¸€è‡´æ€§ |
| **å¤šæ™ºèƒ½ä½“è¾©è®º** | å¤šä¸ª LLM æ™ºèƒ½ä½“é€šè¿‡è¾©è®ºç«‹åœºä»¥æ”¶æ•›åˆ°äº‹å®çœŸç›¸ |
| **RAG** | æ£€ç´¢å¢å¼ºç”Ÿæˆ (Retrieval-Augmented Generation) - ä½¿ç”¨æ£€ç´¢åˆ°çš„æ–‡æ¡£æ¥ ground LLM |
| **ModernBERT** | æ”¯æŒ 8K ä¸Šä¸‹æ–‡çš„æœ€å…ˆè¿›ç¼–ç å™¨æ¶æ„ |
| **å‡†ç¡®ç‡-å»¶è¿Ÿ-æˆæœ¬ä¸‰è§’å½¢** | hallucination ç¼“è§£ç­–ç•¥ä¸­çš„åŸºæœ¬æƒè¡¡ |
| **æ”¶æ•› threshold** | ä½äºè¯¥åˆ†æ•°çš„ hallucination è¢«è§†ä¸ºå·²è§£å†³ |

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0 | **æœ€åæ›´æ–°ï¼š** 2025 å¹´ 12 æœˆ
