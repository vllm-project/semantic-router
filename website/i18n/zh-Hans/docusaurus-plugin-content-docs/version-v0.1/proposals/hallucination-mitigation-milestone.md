# TruthLens: å®æ—¶å¹»è§‰ç¼“è§£

**ç‰ˆæœ¬:** 1.0
**ä½œè€…:** vLLM Semantic Router å›¢é˜Ÿ
**æ—¥æœŸ:** 2025å¹´12æœˆ

---

## æ‘˜è¦

å¤§å‹è¯­è¨€æ¨¡å‹ (LLM) å±•ç°äº†å“è¶Šçš„èƒ½åŠ›ï¼Œä½†å®ƒä»¬äº§ç”Ÿå¹»è§‰ï¼ˆæµç•…ä½†å®é™…ä¸Šä¸æ­£ç¡®æˆ–æ— æ ¹æ®çš„å†…å®¹ï¼‰çš„å€¾å‘ä»ç„¶æ˜¯ä¼ä¸šé‡‡ç”¨ AI çš„å…³é”®éšœç¢ã€‚è¡Œä¸šè°ƒæŸ¥ä¸€è‡´è¡¨æ˜ï¼Œå¹»è§‰é£é™©æ˜¯é˜»æ­¢ç»„ç»‡åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½² LLM é©±åŠ¨çš„åº”ç”¨ç¨‹åºçš„é¦–è¦æ‹…å¿§ä¹‹ä¸€ï¼Œç‰¹åˆ«æ˜¯åœ¨åŒ»ç–—ä¿å¥ã€é‡‘èå’Œæ³•å¾‹æœåŠ¡ç­‰é«˜é£é™©é¢†åŸŸã€‚

æˆ‘ä»¬æå‡ºäº† **TruthLens**ï¼Œè¿™æ˜¯ä¸€ä¸ªé›†æˆåˆ° vLLM Semantic Router ä¸­çš„å®æ—¶å¹»è§‰æ£€æµ‹å’Œç¼“è§£æ¡†æ¶ã€‚é€šè¿‡å°†å¹»è§‰æ§åˆ¶å®šä½åœ¨æ¨ç† Gateway å±‚ï¼ŒTruthLens æä¾›äº†ä¸€ä¸ªä¸æ¨¡å‹æ— å…³çš„é›†ä¸­å¼è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å¯é…ç½®çš„ç¼“è§£ç­–ç•¥è§£å†³â€œå‡†ç¡®ç‡-å»¶è¿Ÿ-æˆæœ¬â€ä¸‰è§’é—®é¢˜ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®å…¶å¯¹æˆæœ¬å’Œå‡†ç¡®ç‡æƒè¡¡çš„å®¹å¿åº¦ï¼Œä»ä¸‰ç§æ“ä½œæ¨¡å¼ä¸­è¿›è¡Œé€‰æ‹©ï¼š(1) **Lightweight Mode**â€”â€”å¸¦æœ‰è­¦å‘Šæ³¨å…¥çš„å•è½®æ£€æµ‹ï¼Œ(2) **Standard Mode**â€”â€”ä½¿ç”¨åŒä¸€æ¨¡å‹è¿›è¡Œè¿­ä»£è‡ªæˆ‘å®Œå–„ï¼Œä»¥åŠ (3) **Premium Mode**â€”â€”å¤šæ¨¡å‹äº¤å‰éªŒè¯å’Œåä½œä¿®æ­£ã€‚è¿™ç§è®¾è®¡ä½¿ç»„ç»‡èƒ½å¤Ÿéƒ¨ç½²å€¼å¾—ä¿¡èµ–çš„ AI ç³»ç»Ÿï¼ŒåŒæ—¶ä¿æŒå¯¹è¿è¥æˆæœ¬å’Œå“åº”å»¶è¿Ÿçš„æ§åˆ¶ã€‚

---

## 1. å¼•è¨€ï¼šä¼ä¸š AI ä¸­çš„å¹»è§‰å±æœº

### 1.1 æ ¸å¿ƒé—®é¢˜

å¹»è§‰ä»£è¡¨äº†å½“ä»Šä¼ä¸š AI é‡‡ç”¨çš„æœ€é‡å¤§éšœç¢ã€‚ä¸ä¼ ç»Ÿè½¯ä»¶æ¼æ´ä¸åŒï¼ŒLLM å¹»è§‰å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **ä¸å¯é¢„æµ‹**: å®ƒä»¬åœ¨ä¸åŒçš„æŸ¥è¯¢å’Œä¸Šä¸‹æ–‡ä¸­éšæœºå‘ç”Ÿ
- **å…·æœ‰è¯´æœåŠ›**: å¹»è§‰å†…å®¹é€šå¸¸çœ‹èµ·æ¥æµç•…ã€è‡ªä¿¡ä¸”çœ‹ä¼¼åˆç†
- **é«˜é£é™©**: åŒ»ç–—ã€æ³•å¾‹æˆ–é‡‘èé¢†åŸŸçš„å•ä¸€å¹»è§‰å¯èƒ½é€ æˆä¸å¯é€†è½¬çš„ä¼¤å®³
- **ä¸å¯è§**: å¦‚æœæ²¡æœ‰ä¸“é—¨çš„æ£€æµ‹ï¼Œç”¨æˆ·æ— æ³•åŒºåˆ†å¹»è§‰å’Œå‡†ç¡®çš„å“åº”

**æŒ‰é¢†åŸŸåˆ’åˆ†çš„è¡Œä¸šå½±å“:**

| é¢†åŸŸ | å¹»è§‰é£é™©å®¹å¿åº¦ | å…¸å‹ç¼“è§£æ–¹æ³• |
|--------|------------------------------|----------------------------|
| åŒ»ç–—ä¿å¥ | æ¥è¿‘é›¶ï¼ˆç”Ÿå‘½æ”¸å…³ï¼‰ | å¼ºåˆ¶äººå·¥éªŒè¯ï¼Œè´£ä»»é—®é¢˜ |
| é‡‘èæœåŠ¡ | éå¸¸ä½ï¼ˆç›‘ç®¡ï¼‰ | åˆè§„é©±åŠ¨çš„å®¡æŸ¥æµç¨‹ |
| æ³•å¾‹ | éå¸¸ä½ï¼ˆè´£ä»»ï¼‰ | ä»…é™äºå†…éƒ¨ç ”ç©¶å’Œèµ·è‰ |
| å®¢æˆ·æ”¯æŒ | ä¸­ç­‰ | ä¸ç¡®å®šå“åº”çš„å‡çº§åè®® |
| åˆ›æ„/è¥é”€ | é«˜å®¹å¿åº¦ | éœ€è¦æœ€å°‘çš„å¹²é¢„ |

*æ³¨ï¼šåŸºäºè·¨è¡Œä¸šè°ƒæŸ¥ï¼ˆMcKinsey 2024, Gartner 2024, Menlo Ventures 2024ï¼‰è§‚å¯Ÿåˆ°çš„ä¼ä¸šéƒ¨ç½²æ¨¡å¼ã€‚*

### 1.2 ä¸ºä»€ä¹ˆç°æœ‰è§£å†³æ–¹æ¡ˆä¸è¶³

ç›®å‰çš„å¹»è§‰ç¼“è§£æ–¹æ³•åœ¨ AI æ ˆçš„é”™è¯¯å±‚é¢ä¸Šè¿è¡Œï¼š

```mermaid
flowchart TB
    subgraph "å½“å‰æ–¹æ³•ï¼ˆç¢ç‰‡åŒ–ï¼‰"
        direction TB
        A[RAG/Grounding] -->|ç”Ÿæˆå‰| B[å‡å°‘ä½†ä¸èƒ½æ¶ˆé™¤]
        C[å¾®è°ƒ] -->|è®­ç»ƒæ—¶| D[æ˜‚è´µï¼Œç‰¹å®šäºæ¨¡å‹]
        E[Prompt å·¥ç¨‹] -->|æ¯ä¸ªåº”ç”¨ç¨‹åº| F[ä¸ä¸€è‡´ï¼Œæ— ä¿è¯]
        G[ç¦»çº¿è¯„ä¼°] -->|äº‹å| H[æ— æ³•é˜²æ­¢å®æ—¶å±å®³]
    end

    subgraph "å·®è·"
        I[âŒ æ¨ç†æ—¶æ— å®æ—¶æ£€æµ‹]
        J[âŒ æ— é›†ä¸­æ§åˆ¶ç‚¹]
        K[âŒ æ— æˆæœ¬æ„ŸçŸ¥ç¼“è§£é€‰é¡¹]
    end
```

### 1.3 ä¸ºä»€ä¹ˆ vLLM Semantic Router æ˜¯ç†æƒ³çš„è§£å†³æ–¹æ¡ˆç‚¹

vLLM Semantic Router åœ¨ AI åŸºç¡€è®¾æ–½æ ˆä¸­å æ®ç‹¬ç‰¹ä½ç½®ï¼Œä½¿å…¶éå¸¸é€‚åˆå¹»è§‰ç¼“è§£ï¼š

```mermaid
flowchart LR
    subgraph "å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº"
        APP1[åº”ç”¨ 1]
        APP2[åº”ç”¨ 2]
        APP3[åº”ç”¨ N]
    end

    subgraph "vLLM Semantic Router"
        direction TB
        GW[ç»Ÿä¸€ Gateway]

        subgraph "ç°æœ‰èƒ½åŠ›"
            SEC[å®‰å…¨å±‚<br/>PII, è¶Šç‹±]
            ROUTE[æ™ºèƒ½è·¯ç”±<br/>æ¨¡å‹é€‰æ‹©]
            CACHE[è¯­ä¹‰ç¼“å­˜<br/>æˆæœ¬ä¼˜åŒ–]
        end

        subgraph "æ–°åŠŸèƒ½: TruthLens"
            HALL[å¹»è§‰<br/>æ£€æµ‹ä¸ç¼“è§£]
        end
    end

    subgraph "LLM åç«¯"
        LLM1[GPT-4]
        LLM2[Claude]
        LLM3[Llama]
        LLM4[Mistral]
    end

    APP1 --> GW
    APP2 --> GW
    APP3 --> GW

    GW --> SEC
    SEC --> ROUTE
    ROUTE --> CACHE
    CACHE --> HALL
    CACHE --> HALL

    HALL --> LLM1
    HALL --> LLM2
    HALL --> LLM3
    HALL --> LLM4
```

**Gateway çº§å¹»è§‰æ§åˆ¶çš„å…³é”®ä¼˜åŠ¿:**

| ä¼˜åŠ¿ | æè¿° |
|-----------|-------------|
| **æ¨¡å‹æ— å…³** | é€‚ç”¨äºä»»ä½• LLM åç«¯ï¼Œæ— éœ€ä¿®æ”¹ |
| **é›†ä¸­ç­–ç•¥** | æ‰€æœ‰åº”ç”¨ç¨‹åºçš„å•ä¸€é…ç½®ç‚¹ |
| **æˆæœ¬æ§åˆ¶** | å…¨ç»„ç»‡èŒƒå›´å†…å¯¹å‡†ç¡®ç‡ä¸æˆæœ¬æƒè¡¡çš„å¯è§æ€§ |
| **å¢é‡é‡‡ç”¨** | å¯ç”¨æ¯ä¸ªå†³ç­–ã€æ¯ä¸ªé¢†åŸŸçš„ç­–ç•¥ |
| **å¯è§‚æµ‹æ€§** | å¹»è§‰äº‹ä»¶çš„ç»Ÿä¸€æŒ‡æ ‡ã€æ—¥å¿—è®°å½•å’Œè­¦æŠ¥ |
| **çºµæ·±é˜²å¾¡** | è¡¥å……ï¼ˆè€Œéæ›¿ä»£ï¼‰RAG å’Œ Prompt å·¥ç¨‹ |

### 1.4 æ­£å¼é—®é¢˜å®šä¹‰

æˆ‘ä»¬å°† RAG ç³»ç»Ÿä¸­çš„å¹»è§‰æ£€æµ‹å½¢å¼åŒ–ä¸º **Token çº§åºåˆ—æ ‡æ³¨**é—®é¢˜ã€‚

**å®šä¹‰ 1 (RAG ä¸Šä¸‹æ–‡).** ä»¤ RAG äº¤äº’å®šä¹‰ä¸ºä¸€ä¸ªå…ƒç»„ *(C, Q, R)*ï¼Œå…¶ä¸­ï¼š

- *C = \{câ‚, câ‚‚, ..., câ‚˜\}* æ˜¯æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ï¼ˆæ–‡æ¡£/æ®µè½é›†ï¼‰
- *Q* æ˜¯ç”¨æˆ·æŸ¥è¯¢
- *R = (râ‚, râ‚‚, ..., râ‚™)* æ˜¯ä½œä¸º *n* ä¸ª Token åºåˆ—ç”Ÿæˆçš„å“åº”

**å®šä¹‰ 2 (æœ‰æ ¹æ®çš„ vs. å¹»è§‰ Token).** å“åº” *R* ä¸­çš„ Token *ráµ¢* æ˜¯ï¼š

- **æœ‰æ ¹æ®çš„ (Grounded)** å¦‚æœ *C* ä¸­å­˜åœ¨æ”¯æŒåŒ…å« *ráµ¢* çš„ä¸»å¼ çš„è¯æ®
- **å¹»è§‰çš„ (Hallucinated)** å¦‚æœ *ráµ¢* å¯¼è‡´çš„ä¸»å¼ ï¼š
  - (a) ä¸ *C* ä¸­çš„ä¿¡æ¯ç›¸çŸ›ç›¾ï¼ˆçŸ›ç›¾å¹»è§‰ï¼‰ï¼Œæˆ–
  - (b) æ— æ³•ä» *C* ä¸­éªŒè¯ä¸”ä¸æ˜¯å¸¸è¯†ï¼ˆæ— æ ¹æ®å¹»è§‰ï¼‰

**å®šä¹‰ 3 (å¹»è§‰æ£€æµ‹å‡½æ•°).** æ£€æµ‹ä»»åŠ¡æ˜¯å­¦ä¹ ä¸€ä¸ªå‡½æ•°ï¼š

*f: (C, Q, R) â†’ Y*

å…¶ä¸­ *Y = (yâ‚, yâ‚‚, ..., yâ‚™)* ä¸” *yáµ¢ âˆˆ \{0, 1\}* æŒ‡ç¤º Token *ráµ¢* æ˜¯å¦ä¸ºå¹»è§‰ã€‚

**å®šä¹‰ 4 (å¹»è§‰åˆ†æ•°).** ç»™å®šé¢„æµ‹ *Y* å’Œç½®ä¿¡åº¦åˆ†æ•° *P = (pâ‚, ..., pâ‚™)* å…¶ä¸­ *páµ¢ = P(yáµ¢ = 1)*ï¼Œæˆ‘ä»¬å®šä¹‰ï¼š

- **Token çº§åˆ†æ•°**: *s_token(ráµ¢) = páµ¢*
- **Span çº§åˆ†æ•°**: å¯¹äºè¿ç»­ Span *S = (ráµ¢, ..., râ±¼)*, *s_span(S) = max(páµ¢, ..., pâ±¼)*
- **å“åº”çº§åˆ†æ•°**: *s_response(R) = 1 - âˆ(1 - páµ¢)* å¯¹äºæ‰€æœ‰ *i* å…¶ä¸­ *páµ¢ > Ï„_token*

**å®šä¹‰ 5 (ç¼“è§£å†³ç­–).** ç»™å®šé˜ˆå€¼ *Ï„*ï¼Œç³»ç»Ÿé‡‡å–è¡ŒåŠ¨ï¼š

```text
Action(R) =
  PASS        å¦‚æœ s_response(R) < Ï„
  MITIGATE    å¦‚æœ s_response(R) â‰¥ Ï„
```

---

## 2. ç›¸å…³å·¥ä½œï¼šå¹»è§‰ç¼“è§£çš„æœ€æ–°æŠ€æœ¯

### 2.1 å¹»è§‰ç±»å‹åˆ†ç±»

åœ¨å›é¡¾æ£€æµ‹æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å»ºç«‹å¹»è§‰ç±»å‹çš„åˆ†ç±»æ³•ï¼š

**ç±»å‹ 1: å†…åœ¨å¹»è§‰ (Intrinsic Hallucination)** â€” ç”Ÿæˆçš„å†…å®¹ä¸æä¾›çš„ä¸Šä¸‹æ–‡ç›¸çŸ›ç›¾ã€‚

*ç¤ºä¾‹*: ä¸Šä¸‹æ–‡è¯´â€œä¼šè®®åœ¨å‘¨äºŒâ€ã€‚å“åº”è¯´â€œä¼šè®®å®‰æ’åœ¨å‘¨ä¸‰â€ã€‚

**ç±»å‹ 2: å¤–åœ¨å¹»è§‰ (Extrinsic Hallucination)** â€” ç”Ÿæˆçš„å†…å®¹æ— æ³•ä»ä¸Šä¸‹æ–‡ä¸­éªŒè¯ä¸”ä¸æ˜¯å¸¸è¯†ã€‚

*ç¤ºä¾‹*: ä¸Šä¸‹æ–‡è®¨è®ºäº†å…¬å¸çš„ Q3 æ”¶ç›Šã€‚å“åº”åŒ…å«äº†ä»»ä½•åœ°æ–¹éƒ½æœªæåŠçš„ Q4 é¢„æµ‹ã€‚

**ç±»å‹ 3: æé€  (Fabrication)** â€” å®Œå…¨è™šæ„çš„å®ä½“ã€å¼•ç”¨æˆ–äº‹å®ã€‚

*ç¤ºä¾‹*: â€œæ ¹æ® Smith ç­‰äºº (2023)...â€ï¼Œè€Œå®é™…ä¸Šä¸å­˜åœ¨è¿™æ ·çš„è®ºæ–‡ã€‚

| ç±»å‹ | æ£€æµ‹éš¾åº¦ | ç¼“è§£æ–¹æ³• |
|------|---------------------|---------------------|
| å†…åœ¨ | è¾ƒå®¹æ˜“ï¼ˆç›´æ¥çŸ›ç›¾ï¼‰ | ä¸Šä¸‹æ–‡é‡æ–° Grounding |
| å¤–åœ¨ | ä¸­ç­‰ï¼ˆéœ€è¦çŸ¥è¯†è¾¹ç•Œï¼‰ | ä¸ç¡®å®šæ€§è¡¨è¾¾ |
| æé€  | è¾ƒéš¾ï¼ˆéœ€è¦å¤–éƒ¨éªŒè¯ï¼‰ | äº¤å‰å¼•ç”¨æ£€æŸ¥ |

### 2.2 æ£€æµ‹æ–¹æ³•

| ç±»åˆ« | ä»£è¡¨æ€§å·¥ä½œ | æœºåˆ¶ | å‡†ç¡®ç‡ | å»¶è¿Ÿ | æˆæœ¬ |
|----------|---------------------|-----------|----------|---------|------|
| **åŸºäº Encoder** | LettuceDetect (2025), Luna (2025) | ä½¿ç”¨ ModernBERT/DeBERTa è¿›è¡Œ Token åˆ†ç±» | F1: 75-79% | 15-35ms | ä½ |
| **è‡ªæˆ‘ä¸€è‡´æ€§** | SelfCheckGPT (2023) | å¤šé‡é‡‡æ · + ä¸€è‡´æ€§æ£€æŸ¥ | å˜åŒ– | Nx åŸºç¡€ | é«˜ |
| **è·¨æ¨¡å‹** | Finch-Zk (2025) | å¤šæ¨¡å‹å“åº”æ¯”è¾ƒ | F1: +6-39% | 2-3x åŸºç¡€ | é«˜ |
| **å†…éƒ¨çŠ¶æ€** | MIND (ACL 2024) | éšè—å±‚æ¿€æ´»åˆ†æ | é«˜ | \<10ms | éœ€è¦ä»ªå™¨åŒ– |

#### 2.2.1 åŸºäº Encoder çš„æ£€æµ‹ï¼ˆæ·±å…¥æ¢è®¨ï¼‰

**LettuceDetect** (KovÃ¡cs ç­‰äºº, 2025) å°†å¹»è§‰æ£€æµ‹æ¡†æ¶åŒ–ä¸º **Token çº§åºåˆ—æ ‡æ³¨**ï¼š

- **æ¶æ„**: ModernBERT-large (3.95äº¿å‚æ•°) å¸¦åˆ†ç±»å¤´
- **è¾“å…¥**: æ‹¼æ¥çš„ [Context, Query, Response] å¸¦ç‰¹æ®Š Token
- **è¾“å‡º**: æ¯ä¸ª Token çš„å¹»è§‰æ¦‚ç‡
- **è®­ç»ƒ**: åœ¨ RAGTruth æ•°æ®é›†ï¼ˆ1.8ä¸‡ç¤ºä¾‹ï¼‰ä¸Šå¾®è°ƒ
- **å…³é”®åˆ›æ–°**: é•¿ä¸Šä¸‹æ–‡å¤„ç†ï¼ˆ8K Tokenï¼‰æ”¯æŒå®Œæ•´ RAG ä¸Šä¸‹æ–‡åŒ…å«

**RAGTruth åŸºå‡†æµ‹è¯•è¡¨ç°**:

| æ¨¡å‹ | Token F1 | ç¤ºä¾‹ F1 | å»¶è¿Ÿ |
|-------|----------|------------|---------|
| LettuceDetect-large | 79.22% | 74.8% | ~30ms |
| LettuceDetect-base | 76.5% | 71.2% | ~15ms |
| Luna (DeBERTa) | 73.1% | 68.9% | ~25ms |
| GPT-4 (zero-shot) | 61.2% | 58.4% | ~2s |

**ä¸ºä»€ä¹ˆé€‰æ‹©åŸºäº Encoder ç”¨äº TruthLens**: é«˜å‡†ç¡®ç‡ã€ä½å»¶è¿Ÿå’Œå›ºå®šæˆæœ¬çš„ç»“åˆä½¿å¾—åŸºäº Encoder çš„æ£€æµ‹æˆä¸º Gateway çº§éƒ¨ç½²çš„ç†æƒ³é€‰æ‹©ã€‚

#### 2.2.2 è‡ªæˆ‘ä¸€è‡´æ€§æ–¹æ³•

**SelfCheckGPT** (Manakul ç­‰äºº, 2023) åˆ©ç”¨äº†å¹»è§‰åœ¨æ ·æœ¬é—´ä¸ä¸€è‡´çš„è§‚å¯Ÿç»“æœï¼š

- **æœºåˆ¶**: ç”Ÿæˆ N ä¸ªå“åº”ï¼Œæµ‹é‡ä¸€è‡´æ€§
- **ç›´è§‰**: äº‹å®å†…å®¹æ˜¯å¯å¤ç°çš„ï¼›å¹»è§‰å„ä¸ç›¸åŒ
- **å±€é™æ€§**: éœ€è¦ N æ¬¡ LLM è°ƒç”¨ï¼ˆé€šå¸¸ N=5-10ï¼‰

**ç†è®ºåŸºç¡€**: å¦‚æœ *P(fact)* é«˜ï¼Œäº‹å®ä¼šå‡ºç°åœ¨å¤§å¤šæ•°æ ·æœ¬ä¸­ã€‚å¦‚æœæ¯ä¸ªæ ·æœ¬çš„ *P(hallucination)* ä½ï¼Œå®ƒå¾ˆå°‘é‡å¤ã€‚

#### 2.2.3 è·¨æ¨¡å‹éªŒè¯

**Finch-Zk** (2025) åˆ©ç”¨æ¨¡å‹å¤šæ ·æ€§ï¼š

- **æœºåˆ¶**: æ¯”è¾ƒæ¥è‡ªä¸åŒæ¨¡å‹å®¶æ—çš„å“åº”
- **å…³é”®æ´å¯Ÿ**: ä¸åŒæ¨¡å‹çš„å¹»è§‰æ–¹å¼ä¸åŒ
- **åˆ†æ®µçº§ä¿®æ­£**: ç”¨æ›´é«˜ç½®ä¿¡åº¦çš„ç‰ˆæœ¬æ›¿æ¢ä¸ä¸€è‡´çš„ç‰‡æ®µ

### 2.3 ç¼“è§£ç­–ç•¥

| ç­–ç•¥ | ä»£è¡¨æ€§å·¥ä½œ | æœºåˆ¶ | æœ‰æ•ˆæ€§ | å¼€é”€ |
|----------|---------------------|-----------|---------------|----------|
| **è‡ªæˆ‘å®Œå–„** | Self-Refine (NeurIPS 2023) | è¿­ä»£åé¦ˆå¾ªç¯ | å‡å°‘ 40-60% | 2-4x å»¶è¿Ÿ |
| **Chain-of-Verification** | CoVe (ACL 2024) | ç”ŸæˆéªŒè¯é—®é¢˜ | å‡å°‘ 50-70% | 3-5x å»¶è¿Ÿ |
| **Multi-Agent Debate** | MAD (2024) | å¤šä¸ª Agent è¾©è®ºå¹¶æ”¶æ•› | å‡å°‘ 60-80% | 5-10x å»¶è¿Ÿ |
| **è·¨æ¨¡å‹ä¿®æ­£** | Finch-Zk (2025) | ç›®æ ‡åˆ†æ®µæ›¿æ¢ | å‡†ç¡®ç‡æå‡é«˜è¾¾ 9% | 3x å»¶è¿Ÿ |

#### 2.3.1 è‡ªæˆ‘å®Œå–„ï¼ˆæ·±å…¥æ¢è®¨ï¼‰

**Self-Refine** (Madaan ç­‰äºº, NeurIPS 2023) è¯æ˜äº† LLM å¯ä»¥æ”¹è¿›è‡ªå·±çš„è¾“å‡ºï¼š

```text
å¾ªç¯:
  1. ç”Ÿæˆåˆå§‹å“åº” Râ‚€
  2. ç”Ÿæˆå…³äº Râ‚€ çš„åé¦ˆ Fï¼ˆåŒä¸€æ¨¡å‹ï¼‰
  3. ä½¿ç”¨ F ç”Ÿæˆå®Œå–„åçš„å“åº” Râ‚
  4. é‡å¤ç›´åˆ°æ”¶æ•›æˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°
```

**å…³é”®å‘ç°**:

- å½“åé¦ˆ**å…·ä½“**æ—¶æ•ˆæœæœ€å¥½ï¼ˆä¸ä»…ä»…æ˜¯â€œæ”¹è¿›è¿™ä¸ªâ€ï¼‰
- 2-3 æ¬¡è¿­ä»£åæ”¶ç›Šé€’å‡
- éœ€è¦æ¨¡å‹å…·å¤‡è‡ªæˆ‘ä¿®æ­£çš„çŸ¥è¯†

**å¹»è§‰çš„å±€é™æ€§**: å¦‚æœæ¨¡å‹ç¼ºä¹æ­£ç¡®çš„çŸ¥è¯†ï¼Œè‡ªæˆ‘å®Œå–„å¯èƒ½æ²¡æœ‰å¸®åŠ©ï¼Œç”šè‡³å¯èƒ½å¼•å…¥æ–°çš„é”™è¯¯ã€‚

#### 2.3.2 Chain-of-Verification (CoVe)

**CoVe** (Dhuliawala ç­‰äºº, ACL 2024) ç”ŸæˆéªŒè¯é—®é¢˜ï¼š

```text
1. ç”Ÿæˆå“åº” R
2. ä» R ä¸­æå–äº‹å®ä¸»å¼ 
3. å¯¹æ¯ä¸ªä¸»å¼ ï¼Œç”ŸæˆéªŒè¯é—®é¢˜
4. ä½¿ç”¨ä¸Šä¸‹æ–‡å›ç­”éªŒè¯é—®é¢˜
5. æ ¹æ®éªŒè¯ç»“æœä¿®æ”¹ R
```

**ä¼˜åŠ¿**: æ˜¾å¼éªŒè¯æ­¥éª¤æ•æ‰ç»†å¾®é”™è¯¯ã€‚
**åŠ£åŠ¿**: ç”±äºå¤šæ­¥è¿‡ç¨‹å¯¼è‡´é«˜å»¶è¿Ÿ (3-5x)ã€‚

#### 2.3.3 Multi-Agent Debate

**Multi-Agent Debate** (Du ç­‰äºº, 2024) ä½¿ç”¨å¤šä¸ª LLM å®ä¾‹ï¼š

```text
1. å¤šä¸ª Agent ç”Ÿæˆå“åº”
2. Agent ç›¸äº’æ‰¹è¯„å¯¹æ–¹çš„å“åº”
3. Agent æ ¹æ®æ‰¹è¯„è¿›è¡Œä¿®æ”¹
4. é‡å¤ N è½®
5. ç»¼åˆæœ€ç»ˆå“åº”
```

**ç†è®ºä¼˜åŠ¿**: å¤šæ ·åŒ–çš„è§†è§’æ•æ‰ç›²ç‚¹ã€‚
**å®é™…æŒ‘æˆ˜**: é«˜æˆæœ¬ (5-10x) å’Œå»¶è¿Ÿã€‚

### 2.3 å‡†ç¡®ç‡-å»¶è¿Ÿ-æˆæœ¬ä¸‰è§’

ç ”ç©¶ä¸€è‡´æ˜¾ç¤ºäº†ä¸€ä¸ªåŸºæœ¬çš„æƒè¡¡ï¼š

```mermaid
graph TD
    subgraph "æƒè¡¡ä¸‰è§’"
        ACC[ğŸ¯ å‡†ç¡®ç‡]
        LAT[âš¡ å»¶è¿Ÿ]
        COST[ğŸ’° æˆæœ¬]

        ACC ---|æƒè¡¡| LAT
        LAT ---|æƒè¡¡| COST
        COST ---|æƒè¡¡| ACC
    end

    subgraph "ç­–ç•¥å®šä½"
        L[Lightweight Mode<br/>âš¡ğŸ’° å¿«é€Ÿ & å»‰ä»·<br/>ğŸ¯ ä¸­ç­‰å‡†ç¡®ç‡]
        S[Standard Mode<br/>âš¡ğŸ¯ å¹³è¡¡<br/>ğŸ’° ä¸­ç­‰æˆæœ¬]
        P[Premium Mode<br/>ğŸ¯ğŸ’° é«˜å‡†ç¡®ç‡<br/>âš¡ è¾ƒé«˜å»¶è¿Ÿ]
    end

    L --> LAT
    L --> COST
    S --> ACC
    S --> LAT
    P --> ACC
```

**å…³é”®æ´å¯Ÿ**: æ²¡æœ‰å•ä¸€æ–¹æ³•èƒ½ä¼˜åŒ–æ‰€æœ‰ä¸‰ä¸ªç»´åº¦ã€‚TruthLens é€šè¿‡æä¾›**ç”¨æˆ·å¯é€‰æ‹©çš„æ“ä½œæ¨¡å¼**æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®©ç»„ç»‡åœ¨è¿™ä¸ªæƒè¡¡ä¸‰è§’ä¸Šé€‰æ‹©è‡ªå·±çš„ä½ç½®ã€‚

---

## 3. ç†è®ºåŸºç¡€

æœ¬èŠ‚å»ºç«‹äº† TruthLens ä¸‰ç§æ¨¡å¼æ¶æ„çš„ç†è®ºåŸºç¡€ï¼Œå€Ÿé‰´äº†åºåˆ—æ ‡æ³¨ã€è¿­ä»£ä¼˜åŒ–ã€é›†æˆå­¦ä¹ å’Œå¤š Agent ç³»ç»Ÿç†è®ºã€‚

### 3.1 å¹»è§‰æ£€æµ‹ä½œä¸ºåºåˆ—æ ‡æ³¨

#### 3.1.1 Token åˆ†ç±»æ¶æ„

ç°ä»£å¹»è§‰æ£€æµ‹åˆ©ç”¨å¾®è°ƒç”¨äº Token åˆ†ç±»çš„åŸºäº Transformer çš„ Encoderã€‚ç»™å®šè¾“å…¥åºåˆ— *X = [CLS] C [SEP] Q [SEP] R [SEP]*ï¼ŒEncoder äº§ç”Ÿä¸Šä¸‹æ–‡åŒ–çš„è¡¨ç¤ºï¼š

*H = Encoder(X) âˆˆ â„^(LÃ—d)*

å…¶ä¸­ *L* æ˜¯åºåˆ—é•¿åº¦ï¼Œ*d* æ˜¯éšè—ç»´åº¦ã€‚å¯¹äºå“åº”ä¸­çš„æ¯ä¸ª Token *ráµ¢*ï¼Œæˆ‘ä»¬è®¡ç®—ï¼š

*P(yáµ¢ = 1|X) = Ïƒ(W Â· háµ¢ + b)*

å…¶ä¸­ *W âˆˆ â„^d*, *b âˆˆ â„* æ˜¯å­¦ä¹ åˆ°çš„å‚æ•°ï¼Œ*Ïƒ* æ˜¯ Sigmoid å‡½æ•°ã€‚

#### 3.1.2 ä¸ºä»€ä¹ˆé€‰æ‹© ModernBERT è¿›è¡Œæ£€æµ‹

Encoder æ¶æ„çš„é€‰æ‹©æ˜¾è‘—å½±å“æ£€æµ‹è´¨é‡ã€‚æˆ‘ä»¬é‡‡ç”¨ ModernBERT (Warner ç­‰äºº, 2024)ï¼Œå› ä¸ºå®ƒå…·æœ‰ä»¥ä¸‹ç†è®ºä¼˜åŠ¿ï¼š

| å±æ€§ | ModernBERT | ä¼ ç»Ÿ BERT | å¯¹æ£€æµ‹çš„å½±å“ |
|----------|------------|------------------|---------------------|
| **ä¸Šä¸‹æ–‡é•¿åº¦** | 8,192 Token | 512 Token | å¤„ç†å®Œæ•´çš„ RAG ä¸Šä¸‹æ–‡è€Œä¸æˆªæ–­ |
| **Attention** | æ—‹è½¬ä½ç½®åµŒå…¥ (RoPE) | ç»å¯¹ä½ç½® | æ›´å¥½çš„é•¿è·ç¦»ä¾èµ–å»ºæ¨¡ |
| **æ¶æ„** | GeGLU æ¿€æ´»ï¼Œæ— åç½® | GELUï¼Œå¸¦åç½® | æ”¹è¿›ç»†ç²’åº¦åˆ†ç±»çš„æ¢¯åº¦æµ |
| **æ•ˆç‡** | Flash Attention, Unpadding | æ ‡å‡† Attention | 2x æ¨ç†åŠ é€Ÿå®ç°å®æ—¶æ£€æµ‹ |

#### 3.1.3 è¯„åˆ†å‡½æ•°è®¾è®¡

ä» Token çº§åˆ°å“åº”çº§åˆ†æ•°çš„èšåˆéœ€è¦ç²¾å¿ƒè®¾è®¡ã€‚æˆ‘ä»¬æå‡ºä¸€ä¸ª **Noisy-OR** èšåˆæ¨¡å‹ï¼š

*s_response(R) = 1 - âˆáµ¢(1 - páµ¢ Â· ğŸ™[páµ¢ > Ï„_token])*

**ç†è®ºè®ºè¯**: Noisy-OR æ¨¡å‹å‡è®¾ä¸åŒ Token å¤„çš„å¹»è§‰äº‹ä»¶æ˜¯ç‹¬ç«‹çš„ã€‚è™½ç„¶è¿™æ˜¯ä¸€ç§è¿‘ä¼¼ï¼Œä½†å®ƒæä¾›äº†ï¼š

1. **å•è°ƒæ€§**: å¢åŠ ä¸€ä¸ªå¹»è§‰ Token æ°¸è¿œä¸ä¼šé™ä½å“åº”åˆ†æ•°
2. **æ•æ„Ÿæ€§**: å•ä¸ªé«˜ç½®ä¿¡åº¦å¹»è§‰ä¼šè§¦å‘æ£€æµ‹
3. **æ ¡å‡†**: åˆ†æ•°è¿‘ä¼¼ *P(âˆƒ å“åº” R ä¸­çš„å¹»è§‰)*

**æ›¿ä»£æ–¹æ¡ˆï¼šåŸºäº Span çš„èšåˆ**

å¯¹äºç›¸å…³è”çš„å¹»è§‰ï¼ˆå¸¸è§äºæé€ å®ä½“ï¼‰ï¼Œæˆ‘ä»¬é¦–å…ˆå°†è¿ç»­çš„å¹»è§‰ Token åˆ†ç»„ä¸º Spanï¼Œç„¶åèšåˆï¼š

*s_response(R) = max\{s_span(Sâ‚), s_span(Sâ‚‚), ..., s_span(Sâ‚–)\}*

è¿™é™ä½äº†å¯¹åˆ†è¯ä¼ªå½±çš„æ•æ„Ÿæ€§ï¼Œå¹¶ä¸“æ³¨äºè¯­ä¹‰å•å…ƒã€‚

#### 3.1.4 é˜ˆå€¼é€‰æ‹©ç†è®º

æ£€æµ‹é˜ˆå€¼ *Ï„* æ§åˆ¶ç²¾ç¡®ç‡-å¬å›ç‡çš„æƒè¡¡ã€‚æ ¹æ®å†³ç­–ç†è®ºï¼š

**å‘½é¢˜ 1 (æœ€ä¼˜é˜ˆå€¼).** *ç»™å®šæˆæœ¬æ¯” Î» = C_FN / C_FPï¼ˆå‡é˜´æ€§æˆæœ¬ä¸å‡é˜³æ€§æˆæœ¬ä¹‹æ¯”ï¼‰ï¼Œæœ€ä¼˜é˜ˆå€¼æ»¡è¶³ï¼š*

*Ï„* = 1 / (1 + Î» Â· (1-Ï€)/Ï€)*

*å…¶ä¸­ Ï€ æ˜¯å¹»è§‰çš„å…ˆéªŒæ¦‚ç‡ã€‚*

**å®é™…æ„ä¹‰**:

| é¢†åŸŸ | Î» (æˆæœ¬æ¯”) | æ¨è Ï„ | ç†ç”± |
|--------|----------------|---------------|-----------|
| åŒ»ç–— | 10-100 | 0.3-0.5 | æ¼æ‰å¹»è§‰æ˜¯ç¾éš¾æ€§çš„ |
| é‡‘è | 5-20 | 0.4-0.6 | é”™è¯¯ä¿¡æ¯å¸¦æ¥çš„ç›‘ç®¡é£é™© |
| å®¢æˆ·æ”¯æŒ | 1-2 | 0.6-0.7 | å¹³è¡¡ç”¨æˆ·ä½“éªŒå’Œå‡†ç¡®æ€§ |
| åˆ›æ„ | 0.1-0.5 | 0.8-0.9 | è¿‡åº¦æ ‡è®°æŸå®³åˆ›é€ åŠ› |

### 3.2 è‡ªæˆ‘å®Œå–„ç†è®º

#### 3.2.1 è¿­ä»£å®Œå–„ä½œä¸ºä¸åŠ¨ç‚¹è¿­ä»£

Standard Mode é‡‡ç”¨è¿­ä»£è‡ªæˆ‘å®Œå–„ï¼Œè¿™å¯ä»¥å½¢å¼åŒ–ä¸ºå¯»æ‰¾å®Œå–„ç®—å­çš„ä¸åŠ¨ç‚¹ã€‚

**å®šä¹‰ 6 (å®Œå–„ç®—å­).** ä»¤ *T: R â†’ R* ä¸ºå®Œå–„ç®—å­ï¼Œå…¶ä¸­ï¼š

*T(Râ‚œ) = LLM(Prompt_refine(C, Q, Râ‚œ, Detect(Râ‚œ)))*

è¿­ä»£è¿‡ç¨‹ä¸ºï¼š*Râ‚€ â†’ Râ‚ â†’ Râ‚‚ â†’ ... â†’ R**

**å®šç† 1 (æ”¶æ•›æ¡ä»¶).** *å®Œå–„åºåˆ— \{Râ‚œ\} æ”¶æ•›äºä¸åŠ¨ç‚¹ R\* å¦‚æœï¼š*

1. *å¹»è§‰åˆ†æ•°åºåˆ— \{s(Râ‚œ)\} å•è°ƒéé€’å¢*
2. *åˆ†æ•°æœ‰ä¸‹ç•Œ (s(R) â‰¥ 0)*
3. *LLM è¡¨ç°å‡ºä¸€è‡´æ€§ï¼šç›¸ä¼¼çš„ Prompt äº§ç”Ÿç›¸ä¼¼çš„è¾“å‡º*

**è¯æ˜è‰å›¾**: æ¡ä»¶ 1 å’Œ 2 ç¡®ä¿åˆ†æ•°åºåˆ—æ ¹æ®å•è°ƒæ”¶æ•›å®šç†æ”¶æ•›ã€‚æ¡ä»¶ 3ï¼ˆLLM ä¸€è‡´æ€§ï¼‰ç¡®ä¿å“åº”åºåˆ—æœ¬èº«æ”¶æ•›ï¼Œè€Œä¸ä»…ä»…æ˜¯åˆ†æ•°ã€‚

#### 3.2.2 æ”¶æ•›é€Ÿåº¦åˆ†æ

**å®è¯è§‚å¯Ÿ**: è‡ªæˆ‘å®Œå–„é€šå¸¸è¡¨ç°å‡º **æ¬¡çº¿æ€§æ”¶æ•›**ï¼š

*s(Râ‚œ) - s(R*) â‰¤ O(1/t)*

è¿™æ˜¯å› ä¸ºï¼š

1. **ç®€å•çš„å¹»è§‰**ï¼ˆæ˜¾å¼çŸ›ç›¾ï¼‰åœ¨æ—©æœŸè¿­ä»£ä¸­è¢«ä¿®æ­£
2. **å›°éš¾çš„å¹»è§‰**ï¼ˆå¾®å¦™çš„æ— æ ¹æ®ä¸»å¼ ï¼‰å¯èƒ½ä¼šæŒç»­å­˜åœ¨æˆ–éœ‡è¡
3. **æ”¶ç›Šé€’å‡** åœ¨å®è·µä¸­ 2-3 æ¬¡è¿­ä»£åå‡ºç°

```mermaid
graph LR
    subgraph "æ”¶æ•›æ¨¡å¼"
        R0[Râ‚€<br/>s=0.8] -->|è¿­ä»£ 1| R1[Râ‚<br/>s=0.5]
        R1 -->|è¿­ä»£ 2| R2[Râ‚‚<br/>s=0.35]
        R2 -->|è¿­ä»£ 3| R3[Râ‚ƒ<br/>s=0.3]
        R3 -.->|æ”¶ç›Šé€’å‡| R4[Râ‚„<br/>s=0.28]
    end
```

#### 3.2.3 ä¿®æ­£çš„ Prompt å·¥ç¨‹åŸåˆ™

æœ‰æ•ˆçš„å®Œå–„ Prompt å¿…é¡»æ»¡è¶³å‡ ä¸ªç†è®ºå±æ€§ï¼š

**åŸåˆ™ 1 (ç‰¹å¼‚æ€§)**: Prompt å¿…é¡»è¯†åˆ«*å“ªäº›* Span æ˜¯å¹»è§‰ï¼Œè€Œä¸ä»…ä»…æ˜¯å­˜åœ¨å¹»è§‰ã€‚

**åŸåˆ™ 2 (Grounding)**: Prompt å¿…é¡»æä¾›åŸå§‹ä¸Šä¸‹æ–‡ *C* ä»¥å¯ç”¨äº‹å®æ ¸æŸ¥ã€‚

**åŸåˆ™ 3 (ä¿ç•™)**: Prompt å¿…é¡»æŒ‡ç¤ºæ¨¡å‹ä¿ç•™å‡†ç¡®çš„å†…å®¹ã€‚

**åŸåˆ™ 4 (ä¸ç¡®å®šæ€§)**: å½“æ— æ³•ä¿®æ­£æ—¶ï¼Œæ¨¡å‹åº”è¡¨è¾¾ä¸ç¡®å®šæ€§è€Œä¸æ˜¯æé€ æ›¿ä»£æ–¹æ¡ˆã€‚

**å®Œå–„ Prompt æ¨¡æ¿ç»“æ„**:

```text
ç»™å®š:
- ä¸Šä¸‹æ–‡: [æ£€ç´¢åˆ°çš„æ®µè½ C]
- æŸ¥è¯¢: [ç”¨æˆ·é—®é¢˜ Q]
- å“åº”: [å½“å‰å“åº” Râ‚œï¼Œæ ‡è®°äº†å¹»è§‰ Span]

ä»¥ä¸‹ Span å¯èƒ½æ˜¯å¹»è§‰: [List of (span, confidence)]

æŒ‡ä»¤:
1. å¯¹æ¯ä¸ªæ ‡è®°çš„ Spanï¼Œå¯¹ç…§ä¸Šä¸‹æ–‡è¿›è¡ŒéªŒè¯
2. å¦‚æœçŸ›ç›¾ï¼šä½¿ç”¨ä¸Šä¸‹æ–‡è¯æ®è¿›è¡Œä¿®æ­£
3. å¦‚æœæ— æ³•éªŒè¯ä¸”ä¸æ˜¯å¸¸è¯†ï¼šç§»é™¤æˆ–ç”¨ä¸ç¡®å®šæ€§é™å®š
4. ä¿ç•™æ‰€æœ‰å‡†ç¡®ã€æœ‰æ ¹æ®çš„å†…å®¹
5. ä¿æŒè¿è´¯çš„å™äº‹æµ
```

### 3.3 å¤šæ¨¡å‹åä½œç†è®º

Premium Mode åˆ©ç”¨å¤šä¸ª LLM è¿›è¡Œäº¤å‰éªŒè¯ã€‚æˆ‘ä»¬å°†æ­¤å»ºç«‹åœ¨é›†æˆå­¦ä¹ å’Œå¤š Agent è¾©è®ºç†è®ºçš„åŸºç¡€ä¸Šã€‚

#### 3.3.1 é›†æˆå­¦ä¹ è§†è§’

**å®šç† 2 (å¤šæ ·æ€§-å‡†ç¡®æ€§æƒè¡¡).** *å¯¹äº M ä¸ªæ¨¡å‹çš„é›†æˆï¼Œæ¯ä¸ªæ¨¡å‹çš„é”™è¯¯ç‡ä¸º Îµ ä¸”æˆå¯¹ç›¸å…³æ€§ä¸º Ïï¼Œå¤šæ•°æŠ•ç¥¨ä¸‹çš„é›†æˆé”™è¯¯ç‡ä¸ºï¼š*

*Îµ_ensemble â‰ˆ Îµ Â· (1 + (M-1)Ï) / M*    *å½“ Îµ < 0.5 æ—¶*

**æ¨è®º**: ä»…å½“ Ï < 1ï¼ˆæ¨¡å‹å¤šæ ·åŒ–ï¼‰æ—¶ï¼Œé›†æˆé”™è¯¯ç‡éš M â†’ âˆ è¶‹è¿‘äºé›¶ã€‚

**å¯¹ TruthLens çš„å¯ç¤º**:

| æ¨¡å‹ç»„åˆ | é¢„æœŸå¤šæ ·æ€§ (1-Ï) | é”™è¯¯å‡å°‘ |
|-------------------|--------------------------|-----------------|
| ç›¸åŒæ¨¡å‹å®¶æ— (GPT-4 å˜ä½“) | ä½ (0.2-0.4) | 10-20% |
| ä¸åŒå®¶æ— (GPT-4 + Claude) | ä¸­ (0.4-0.6) | 30-50% |
| ä¸åŒæ¶æ„ (Transformer + å…¶ä»–) | é«˜ (0.6-0.8) | 50-70% |

#### 3.3.2 Multi-Agent Debate æ¡†æ¶

é™¤äº†ç®€å•çš„æŠ•ç¥¨ï¼Œ**è¾©è®º**ä½¿æ¨¡å‹èƒ½å¤Ÿ**äº‰è®º**äº‹å®ä¸»å¼ å¹¶å°±çœŸç†è¾¾æˆä¸€è‡´ã€‚

**å®šä¹‰ 7 (è®ºè¯æ¡†æ¶).** è®ºè¯æ¡†æ¶æ˜¯ä¸€å¯¹ *AF = (A, â†’)* å…¶ä¸­ï¼š

- *A* æ˜¯ä¸€ç»„è®ºç‚¹ï¼ˆæ¥è‡ªæ¯ä¸ªæ¨¡å‹çš„äº‹å®ä¸»å¼ ï¼‰
- *â†’ âŠ† A Ã— A* æ˜¯æ”»å‡»å…³ç³»ï¼ˆä¸»å¼ ä¹‹é—´çš„çŸ›ç›¾ï¼‰

**å®šä¹‰ 8 (Grounded Extension).** AF çš„ Grounded Extension *E* æ˜¯æœ€å¤§çš„æ— å†²çªè®ºç‚¹é›†ï¼Œå®ƒèƒ½æŠµå¾¡æ‰€æœ‰æ”»å‡»ã€‚

**Multi-Agent Debate åè®®**:

```mermaid
sequenceDiagram
    participant Q as æŸ¥è¯¢
    participant M1 as æ¨¡å‹ A<br/>(æè®®è€…)
    participant M2 as æ¨¡å‹ B<br/>(æ‰¹è¯„è€…)
    participant J as æ³•å®˜æ¨¡å‹

    Q->>M1: ç”Ÿæˆå“åº” Râ‚
    Q->>M2: ç”Ÿæˆå“åº” Râ‚‚

    M1->>M2: "ä¸»å¼  X ç”±ä¸Šä¸‹æ–‡æ®µè½ P æ”¯æŒ"
    M2->>M1: "ä¸»å¼  X ä¸æ®µè½ Q çŸ›ç›¾"

    loop è¾©è®ºè½®æ¬¡ (æœ€å¤š 3 è½®)
        M1->>M2: ç”¨è¯æ®å®Œå–„è®ºç‚¹
        M2->>M1: åé©³æˆ–è®©æ­¥
    end

    M1->>J: æœ€ç»ˆç«‹åœº + è¯æ®
    M2->>J: æœ€ç»ˆç«‹åœº + è¯æ®
    J->>Q: ç»¼åˆå“åº” (Grounded Extension)
```

#### 3.3.3 å…±è¯†æœºåˆ¶

**æœºåˆ¶ 1: å¤šæ•°æŠ•ç¥¨**

*y_final(token) = argmax_y |\{m : f_m(token) = y\}|*

- ç®€å•ï¼Œå¿«é€Ÿ
- éœ€è¦å¥‡æ•°ä¸ªæ¨¡å‹
- ä¸è€ƒè™‘æ¨¡å‹ç½®ä¿¡åº¦

**æœºåˆ¶ 2: åŠ æƒç½®ä¿¡åº¦èšåˆ**

*p_final(token) = Î£â‚˜ wâ‚˜ Â· pâ‚˜(token) / Î£â‚˜ wâ‚˜*

å…¶ä¸­ *wâ‚˜* æ˜¯æ¨¡å‹ m çš„æ ¡å‡†å¯é æ€§æƒé‡ã€‚

- è€ƒè™‘ä¸åŒçš„æ¨¡å‹ä¸“é•¿
- éœ€è¦æ ¡å‡†çš„ç½®ä¿¡åº¦åˆ†æ•°

**æœºåˆ¶ 3: åˆ†æ®µçº§æ›¿æ¢ (Finch-Zk)**

å¯¹äºå“åº” *Râ‚* ä¸­çš„æ¯ä¸ªä¸»å¼ åˆ†æ®µ *S*ï¼š

1. æ£€æŸ¥ *S* æ˜¯å¦ï¼ˆè¯­ä¹‰ä¸Šï¼‰å‡ºç°åœ¨ *Râ‚‚* ä¸­
2. å¦‚æœä¸€è‡´ï¼šä¿ç•™ *S*
3. å¦‚æœä¸ä¸€è‡´ï¼šç”¨æ›´å¯é æ¨¡å‹çš„ç‰ˆæœ¬æ›¿æ¢ Sáµ¢
4. è¾“å‡ºï¼šå…·æœ‰æœ€é«˜ç½®ä¿¡åº¦åˆ†æ®µçš„æ··åˆå“åº”

#### 3.3.5 æˆæœ¬-å‡†ç¡®æ€§æƒè¡¡åˆ†æ

| é…ç½® | æ¨¡å‹ | é¢„æœŸå‡†ç¡®ç‡æå‡ | æˆæœ¬å€æ•° |
|---------------|--------|----------------------|-----------------|
| åŒæ¨¡å‹æŠ•ç¥¨ | 2 | +15-25% | 2x |
| ä¸‰æ¨¡å‹æŠ•ç¥¨ | 3 | +25-35% | 3x |
| åŒæ¨¡å‹ + æ³•å®˜ | 2+1 | +30-40% | 3x |
| å…¨è¾©è®º (3 è½®) | 2+1 | +40-50% | 5-6x |

#### 3.3.6 ç†æƒ³ç”¨ä¾‹

- **åŒ»ç–—è¯Šæ–­è¾…åŠ©**: ç”Ÿå‘½æ”¸å…³çš„å†³ç­–
- **æ³•å¾‹æ–‡æ¡£åˆ†æ**: è´£ä»»å½±å“
- **é‡‘èå’¨è¯¢**: éœ€è¦ç›‘ç®¡åˆè§„
- **å®‰å…¨å…³é”®ç³»ç»Ÿ**: èˆªç©ºèˆªå¤©ã€æ ¸èƒ½ç­‰

### 5.6 æ¨¡å¼é€‰æ‹©å†³ç­–æ ‘

```mermaid
flowchart TD
    START[æ–°åº”ç”¨] --> Q1{ç›‘ç®¡<br/>è¦æ±‚?}

    Q1 -->|åŒ»ç–—/é‡‘è/æ³•å¾‹| P[ğŸ”´ Premium Mode]
    Q1 -->|æ— /ä½| Q2{é”™è¯¯çš„<br/>ç”¨æˆ·å½±å“?}

    Q2 -->|é«˜| Q3{é¢„ç®—<br/>é™åˆ¶?}
    Q2 -->|ä½| L[ğŸŸ¢ Lightweight Mode]

    Q3 -->|çµæ´»| S[ğŸŸ¡ Standard Mode]
    Q3 -->|ç´§å¼ | Q4{ç”¨æˆ·èƒ½å¦<br/>éªŒè¯?}

    Q4 -->|æ˜¯| L
    Q4 -->|å¦| S

    P --> CONFIG_P[é…ç½®:<br/>â€¢ å¤šæ¨¡å‹åç«¯<br/>â€¢ æœ€å¤§è¿­ä»£: 5-10<br/>â€¢ é˜ˆå€¼: 0.3-0.5]

    S --> CONFIG_S[é…ç½®:<br/>â€¢ è‡ªæˆ‘å®Œå–„<br/>â€¢ æœ€å¤§è¿­ä»£: 3-5<br/>â€¢ é˜ˆå€¼: 0.5-0.7]

    L --> CONFIG_L[é…ç½®:<br/>â€¢ è­¦å‘Šæ¨¡æ¿<br/>â€¢ é˜ˆå€¼: 0.6-0.8<br/>â€¢ å…ƒæ•°æ® Header]
```

---

## 6. é…ç½®è®¾è®¡

### 6.1 å…¨å±€é…ç½®

```yaml
# å…¨å±€å¹»è§‰æ£€æµ‹è®¾ç½®
hallucination:
  enabled: true

  # æ£€æµ‹æ¨¡å‹ (åŸºäº ModernBERT)
  model_id: "models/lettucedetect-large-modernbert-en-v1"
  use_cpu: false

  # é»˜è®¤æ“ä½œæ¨¡å¼
  default_mode: "standard"  # lightweight | standard | premium

  # æ£€æµ‹é˜ˆå€¼ (0.0 - 1.0)
  # è¶Šä½ = è¶Šä¸¥æ ¼, è¶Šé«˜ = è¶Šå®½æ¾
  threshold: 0.6

  # Lightweight Mode çš„è­¦å‘Šæ¨¡æ¿
  warning_template: |
    âš ï¸ **æ³¨æ„**: æ­¤å“åº”å¯èƒ½åŒ…å«æ— æ³•æ ¹æ®æä¾›çš„ä¸Šä¸‹æ–‡å®Œå…¨éªŒè¯çš„ä¿¡æ¯ã€‚
    åœ¨é‡‡å–è¡ŒåŠ¨ä¹‹å‰ï¼Œè¯·éªŒè¯å…³é”®äº‹å®ã€‚

  # Standard Mode è®¾ç½®
  standard:
    max_iterations: 3
    convergence_threshold: 0.4  # å¦‚æœåˆ†æ•°ä½äºæ­¤å€¼åˆ™åœæ­¢

  # Premium Mode è®¾ç½®
  premium:
    verification_models:
      - "claude-3-sonnet"
      - "gpt-4-turbo"
    judge_model: "llama-3.1-70b"
    max_iterations: 5
    require_consensus: true
```

### 6.2 æ¯æ¬¡å†³ç­–çš„æ’ä»¶é…ç½®

```yaml
decisions:
  # åŒ»ç–—é¢†åŸŸ - éœ€è¦æœ€å¤§å‡†ç¡®ç‡
  - name: "medical_assistant"
    description: "åŒ»ç–—ä¿¡æ¯æŸ¥è¯¢"
    priority: 100
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "healthcare"
        - type: "keyword"
          name: "medical_terms"
    modelRefs:
      - model: "gpt-4-turbo"
    plugins:
      - type: "hallucination"
        configuration:
          enabled: true
          mode: "premium"
          threshold: 0.3           # éå¸¸ä¸¥æ ¼
          max_iterations: 5
          require_disclaimer: true

  # é‡‘èæœåŠ¡ - é«˜å‡†ç¡®ç‡
  - name: "financial_advisor"
    description: "é‡‘èåˆ†æå’Œå»ºè®®"
    priority: 90
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "finance"
    plugins:
      - type: "hallucination"
        configuration:
          enabled: true
          mode: "standard"
          threshold: 0.5
          max_iterations: 4

  # ä¸€èˆ¬å®¢æˆ·æ”¯æŒ - å¹³è¡¡
  - name: "customer_support"
    description: "ä¸€èˆ¬å®¢æˆ·å’¨è¯¢"
    priority: 50
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "support"
    plugins:
      - type: "hallucination"
        configuration:
          enabled: true
          mode: "standard"
          threshold: 0.6
          max_iterations: 2

  # å†…éƒ¨å·¥å…· - æˆæœ¬ä¼˜åŒ–
  - name: "internal_assistant"
    description: "å†…éƒ¨çŸ¥è¯†åº“æŸ¥è¯¢"
    priority: 30
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "internal"
    plugins:
      - type: "hallucination"
        configuration:
          enabled: true
          mode: "lightweight"
          threshold: 0.7

  # åˆ›æ„å†™ä½œ - ç¦ç”¨æ£€æµ‹
  - name: "creative_writing"
    description: "åˆ›æ„å†…å®¹ç”Ÿæˆ"
    priority: 20
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "creative"
    plugins:
      - type: "hallucination"
        configuration:
          enabled: false  # è¿™é‡Œâ€œå¹»è§‰â€æ˜¯ä¸€ä¸ªç‰¹æ€§
```

### 6.3 å“åº” Header

å½“å¯ç”¨å¹»è§‰æ£€æµ‹æ—¶ï¼Œä»¥ä¸‹ Header å°†æ·»åŠ åˆ°æ‰€æœ‰å“åº”ä¸­ï¼š

| Header | æè¿° | ç¤ºä¾‹å€¼ |
|--------|-------------|----------------|
| `X-TruthLens-Enabled` | æ˜¯å¦æ‰§è¡Œäº†æ£€æµ‹ | `true`, `false` |
| `X-TruthLens-Mode` | ä½¿ç”¨çš„æ“ä½œæ¨¡å¼ | `lightweight`, `standard`, `premium` |
| `X-TruthLens-Score` | å¹»è§‰ç½®ä¿¡åº¦åˆ†æ•° | `0.0` - `1.0` |
| `X-TruthLens-Detected` | å¹»è§‰æ˜¯å¦è¶…è¿‡é˜ˆå€¼ | `true`, `false` |
| `X-TruthLens-Iterations` | å®Œå–„è¿­ä»£æ¬¡æ•° | `0`, `1`, `2`, ... |
| `X-TruthLens-Latency-Ms` | æ£€æµ‹/ç¼“è§£å»¶è¿Ÿ | `35`, `450`, `2100` |

### 6.4 æŒ‡æ ‡å’Œå¯è§‚æµ‹æ€§

**Prometheus æŒ‡æ ‡:**

| æŒ‡æ ‡ | ç±»å‹ | æ ‡ç­¾ | æè¿° |
|--------|------|--------|-------------|
| `truthlens_detections_total` | Counter | `decision`, `mode`, `detected` | æ€»æ£€æµ‹æ“ä½œ |
| `truthlens_score` | Histogram | `decision`, `mode` | åˆ†æ•°åˆ†å¸ƒ |
| `truthlens_latency_seconds` | Histogram | `mode`, `operation` | å¤„ç†å»¶è¿Ÿ |
| `truthlens_iterations` | Histogram | `decision`, `mode` | å®Œå–„è¿­ä»£è®¡æ•° |
| `truthlens_models_used` | Counter | `model`, `role` | Premium Mode ä¸­çš„æ¨¡å‹ä½¿ç”¨æƒ…å†µ |

---

## 7. å‚è€ƒæ–‡çŒ®

1. KovÃ¡cs, Ã., & Recski, G. (2025). *LettuceDetect: A Hallucination Detection Framework for RAG Applications*. arXiv:2502.17125

2. Goel, A., Schwartz, D., & Qi, Y. (2025). *Finch-Zk: Zero-knowledge LLM hallucination detection and mitigation through fine-grained cross-model consistency*. arXiv:2508.14314

3. Lin, Z., Niu, Z., Wang, Z., & Xu, Y. (2024). *Interpreting and Mitigating Hallucination in MLLMs through Multi-agent Debate*. arXiv:2407.20505

4. Tran, K.T., et al. (2025). *Multi-Agent Collaboration Mechanisms: A Survey of LLMs*. arXiv:2501.06322

5. Manakul, P., Liusie, A., & Gales, M.J. (2023). *SelfCheckGPT: Zero-Resource Black-Box Hallucination Detection for Generative Large Language Models*. arXiv:2303.08896

6. Tang, L., et al. (2024). *MiniCheck: Efficient Fact-Checking of LLMs on Grounding Documents*. EMNLP 2024

7. Madaan, A., et al. (2023). *Self-Refine: Iterative Refinement with Self-Feedback*. NeurIPS 2023

8. Dhuliawala, S., et al. (2024). *Chain-of-Verification Reduces Hallucination in Large Language Models*. ACL Findings 2024

9. Su, W., et al. (2024). *Unsupervised Real-Time Hallucination Detection based on LLM Internal States (MIND)*. ACL Findings 2024

10. Belyi, M., et al. (2025). *Luna: A Lightweight Evaluation Model to Catch Language Model Hallucinations*. COLING 2025

---

## é™„å½• A: å®Œæ•´ç³»ç»Ÿæµç¨‹å›¾

```mermaid
flowchart TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        CLIENT[å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº]
    end

    subgraph "Gateway å±‚"
        ENVOY[Envoy Proxy]
    end

    subgraph "vLLM Semantic Router - ExtProc"
        direction TB

        subgraph "è¯·æ±‚å¤„ç†"
            REQ_H[handleRequestHeaders]
            REQ_B[handleRequestBody]

            subgraph "è¯·æ±‚å®‰å…¨"
                PII_REQ[PII æ£€æµ‹]
                JAIL[è¶Šç‹±æ£€æµ‹]
            end

            subgraph "è·¯ç”±"
                CLASS[æ„å›¾åˆ†ç±»]
                DECISION[å†³ç­–å¼•æ“]
                MODEL_SEL[æ¨¡å‹é€‰æ‹©]
            end

            CACHE_CHK[è¯­ä¹‰ç¼“å­˜æ£€æŸ¥]
        end

        subgraph "å“åº”å¤„ç†"
            RES_H[handleResponseHeaders]
            RES_B[handleResponseBody]

            subgraph "TruthLens"
                DETECT[å¹»è§‰<br/>æ£€æµ‹å™¨]
                SCORE[åˆ†æ•°<br/>è¯„ä¼°]

                subgraph "ç¼“è§£"
                    WARN[è­¦å‘Š<br/>æ³¨å…¥]
                    REFINE[è¿­ä»£<br/>å®Œå–„]
                end
            end

            CACHE_UPD[ç¼“å­˜æ›´æ–°]
            METRICS[æŒ‡æ ‡è®°å½•]
        end
    end

    subgraph "åç«¯å±‚"
        VLLM1[vLLM å®ä¾‹ 1]
        VLLM2[vLLM å®ä¾‹ 2]
        VLLMn[vLLM å®ä¾‹ N]
    end

    subgraph "å­˜å‚¨å±‚"
        REDIS[(Redis ç¼“å­˜)]
        MODELS[(æ¨¡å‹æ–‡ä»¶)]
    end

    CLIENT --> ENVOY
    ENVOY <--> REQ_H
    REQ_H --> REQ_B
    REQ_B --> PII_REQ
    PII_REQ --> JAIL
    JAIL --> CLASS
    CLASS --> DECISION
    DECISION --> MODEL_SEL
    MODEL_SEL --> CACHE_CHK

    CACHE_CHK -->|Cache Hit| RES_H
    CACHE_CHK -->|Cache Miss| VLLM1
    CACHE_CHK -->|Cache Miss| VLLM2
    CACHE_CHK -->|Cache Miss| VLLMn

    VLLM1 --> RES_H
    VLLM2 --> RES_H
    VLLMn --> RES_H

    RES_H --> RES_B
    RES_B --> DETECT
    DETECT --> SCORE

    SCORE -->|ä½äºé˜ˆå€¼| CACHE_UPD
    SCORE -->|é«˜äºé˜ˆå€¼| WARN
    SCORE -->|é«˜äºé˜ˆå€¼| REFINE

    WARN --> CACHE_UPD
    REFINE -->|é‡è¯•| VLLM1
    REFINE -->|æ”¶æ•›| CACHE_UPD

    CACHE_UPD --> METRICS
    METRICS --> ENVOY
    ENVOY --> CLIENT

    REDIS <-.-> CACHE_CHK
    REDIS <-.-> CACHE_UPD
    MODELS <-.-> DETECT
```

---

## é™„å½• B: æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------------|
| **Hallucination** | LLM ç”Ÿæˆçš„å†…å®¹äº‹å®ä¸æ­£ç¡®æˆ–ä¸å—ä¸Šä¸‹æ–‡æ”¯æŒ |
| **Intrinsic Hallucination** | æ¥è‡ªæ¨¡å‹å†…éƒ¨å‚æ•°çŸ¥è¯†çš„æé€ äº‹å® |
| **Extrinsic Hallucination** | æ²¡æœ‰åœ¨æä¾›çš„ä¸Šä¸‹æ–‡ä¸­ Grounding çš„å†…å®¹ï¼ˆå¸¸è§äº RAGï¼‰ |
| **ExtProc** | Envoy External Processor - å¯ç”¨ Gateway å¤„çš„è¯·æ±‚/å“åº”ä¿®æ”¹ |
| **Token-Level Detection** | è¯†åˆ«ç‰¹å®šçš„å¹»è§‰ Token/Span |
| **Self-Refinement** | åŒä¸€æ¨¡å‹ä¿®æ­£è‡ªèº«å¹»è§‰çš„è¿­ä»£è¿‡ç¨‹ |
| **Cross-Model Verification** | ä½¿ç”¨å¤šä¸ªä¸åŒæ¨¡å‹éªŒè¯äº‹å®ä¸€è‡´æ€§ |
| **Multi-Agent Debate** | å¤šä¸ª LLM Agent äº‰è®ºç«‹åœºä»¥æ”¶æ•›äºäº‹å®çœŸç† |
| **RAG** | æ£€ç´¢å¢å¼ºç”Ÿæˆ (Retrieval-Augmented Generation) - ç”¨æ£€ç´¢åˆ°çš„æ–‡æ¡£ Grounding LLM |
| **ModernBERT** | æ”¯æŒ 8K ä¸Šä¸‹æ–‡çš„æœ€å…ˆè¿› Encoder æ¶æ„ |
| **Accuracy-Latency-Cost Triangle** | å¹»è§‰ç¼“è§£ç­–ç•¥ä¸­çš„åŸºæœ¬æƒè¡¡ |
| **Convergence Threshold** | å¹»è§‰è¢«è®¤ä¸ºå·²è§£å†³çš„åˆ†æ•° |

---

**æ–‡æ¡£ç‰ˆæœ¬:** 1.0 | **æœ€åæ›´æ–°:** 2025å¹´12æœˆ
