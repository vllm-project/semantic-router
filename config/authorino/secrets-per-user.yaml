# Pattern 1:N — Admin-managed per-user tokens
#
# The admin allocates a local token to each user.
# The Secret's api_key is the local token; annotations hold distinct provider keys.
# Users never see the actual provider keys.
#
# RBAC: The "authz-groups" annotation maps this user to groups that match
# the router's role_bindings subjects. The Secret's metadata.name becomes
# the x-authz-user-id header.
#
# Flow: Alice sends "Bearer sr-alice-local-token-7890"
#       → Authorino matches this Secret
#       → Injects x-user-openai-key: sk-proj-alice-dedicated-openai-key
#       → Injects x-user-anthropic-key: sk-ant-alice-dedicated-anthropic-key
#       → Injects x-authz-user-id: alice
#       → Injects x-authz-user-groups: engineering,premium
#       → ext_proc: credential resolver uses provider keys for upstream auth
#       → ext_proc: authz classifier matches groups against role_bindings
#
apiVersion: v1
kind: Secret
metadata:
  name: alice                              # ← becomes x-authz-user-id
  labels:
    app: semantic-router
    authorino.kuadrant.io/managed-by: authorino
  annotations:
    openai-key: "sk-proj-alice-dedicated-openai-key"
    anthropic-key: "sk-ant-alice-dedicated-anthropic-key"
    authz-groups: "engineering,premium"    # ← becomes x-authz-user-groups
stringData:
  api_key: "sr-alice-local-token-7890"     # admin-issued local token
type: Opaque
