# Pattern N:1 — Shared provider tokens (many users → same provider keys)
#
# Multiple users each have a unique local token, but all map to the same
# shared provider keys (e.g., a team/org pool).
#
# RBAC: Both users share the same group ("free") which maps to the
# free_tier role via role_bindings. They get the same model access.
#
# Flow: Bob sends "Bearer sr-bob-team-token-1111"
#       Carol sends "Bearer sr-carol-team-token-2222"
#       → Both match their respective Secret
#       → Both get x-user-openai-key: sk-proj-shared-team-openai-key-TEAM
#       → Both get x-authz-user-groups: free
#       → ext_proc: role_bindings maps group "free" → role "free_tier"
#       → decision: free_tier → llama-3-70b (self-hosted, zero cost)
#
---
apiVersion: v1
kind: Secret
metadata:
  name: bob                                # ← becomes x-authz-user-id
  labels:
    app: semantic-router
    authorino.kuadrant.io/managed-by: authorino
  annotations:
    openai-key: "sk-proj-shared-team-openai-key-TEAM"
    anthropic-key: "sk-ant-shared-team-anthropic-key-TEAM"
    authz-groups: "free"                   # ← becomes x-authz-user-groups
stringData:
  api_key: "sr-bob-team-token-1111"
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  name: carol                              # ← becomes x-authz-user-id
  labels:
    app: semantic-router
    authorino.kuadrant.io/managed-by: authorino
  annotations:
    openai-key: "sk-proj-shared-team-openai-key-TEAM"
    anthropic-key: "sk-ant-shared-team-anthropic-key-TEAM"
    authz-groups: "free"                   # ← becomes x-authz-user-groups
stringData:
  api_key: "sr-carol-team-token-2222"
type: Opaque
