# NOT Operator Example: Tiered Model Routing
#
# Demonstrates the NOT operator (NOR semantics) for exclusion-based routing.
#
# Use case: Route STEM queries (computer_science, math, physics, engineering, chemistry)
# to a powerful reasoning model, and everything else to a fast general model —
# without enumerating every non-STEM domain explicitly.
#
# The domain classifier recognises 14 domains:
#   business, law, psychology, biology, chemistry, history, other, health,
#   economics, math, physics, computer_science, philosophy, engineering
#
# Decision flow (evaluated by priority):
#   1. stem_decision    (priority 200): AND [domain: computer_science | math | physics |
#                                            engineering | chemistry] → specialized_model
#   2. general_fallback (priority  50): NOT [domain: computer_science, math, physics,
#                                            engineering, chemistry] → general_model
#                                           ↑ matches only when NONE of the STEM domains fire

vllm_endpoints:
  - name: "endpoint1"
    address: "172.28.0.20"
    port: 8002
    weight: 1

model_config:
  "specialized_model":
    reasoning_family: "qwen3"
    preferred_endpoints: ["endpoint1"]
  "general_model":
    preferred_endpoints: ["endpoint1"]

classifier:
  category_model:
    model_id: "models/mom-domain-classifier"
    use_modernbert: false
    threshold: 0.6
    use_cpu: true
    category_mapping_path: "models/mom-domain-classifier/category_mapping.json"

# All 14 domains recognised by the in-tree domain classifier
categories:
  - name: computer_science
    description: "Computer science and programming"
    mmlu_categories: ["computer_science"]
  - name: math
    description: "Mathematics and quantitative reasoning"
    mmlu_categories: ["math"]
  - name: physics
    description: "Physics and physical sciences"
    mmlu_categories: ["physics"]
  - name: engineering
    description: "Engineering and technical problem-solving"
    mmlu_categories: ["engineering"]
  - name: chemistry
    description: "Chemistry and chemical sciences"
    mmlu_categories: ["chemistry"]
  - name: biology
    description: "Biology and life sciences"
    mmlu_categories: ["biology"]
  - name: health
    description: "Health and medical information"
    mmlu_categories: ["health"]
  - name: economics
    description: "Economics and financial topics"
    mmlu_categories: ["economics"]
  - name: business
    description: "Business and management"
    mmlu_categories: ["business"]
  - name: law
    description: "Legal questions and law-related topics"
    mmlu_categories: ["law"]
  - name: psychology
    description: "Psychology and mental health topics"
    mmlu_categories: ["psychology"]
  - name: history
    description: "Historical questions and cultural topics"
    mmlu_categories: ["history"]
  - name: philosophy
    description: "Philosophy and ethical questions"
    mmlu_categories: ["philosophy"]
  - name: other
    description: "General knowledge and miscellaneous topics"
    mmlu_categories: ["other"]

strategy: "priority"

decisions:
  # --- STEM specialization (OR operator across domain conditions) ---
  #
  # Any query classified into one of the five STEM domains is routed to the
  # reasoning-capable model.  OR means: fire if at least one domain matches.
  - name: "stem_decision"
    description: "Route STEM queries to a reasoning-capable model"
    priority: 200
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "computer_science"
        - type: "domain"
          name: "math"
        - type: "domain"
          name: "physics"
        - type: "domain"
          name: "engineering"
        - type: "domain"
          name: "chemistry"
    modelRefs:
      - model: "specialized_model"
        use_reasoning: true
    plugins:
      - type: "system_prompt"
        configuration:
          system_prompt: "You are a STEM expert. Provide rigorous, step-by-step explanations with examples and derivations where appropriate."

  # --- General fallback (NOR = NOT(OR(...))) ---
  #
  # NOT is strictly unary: it takes exactly one child and negates its result.
  # To express "none of these domains", wrap them in OR first, then negate:
  #   NOR(A,B,C,D,E)  ≡  NOT(OR(A,B,C,D,E))
  #
  # This fires only when the OR child evaluates to false, i.e. when NONE of
  # the five STEM domains are detected — the natural catch-all for the other
  # 9 non-STEM domains without enumerating them explicitly.
  - name: "general_fallback"
    description: "Route all non-STEM queries to the fast general model"
    priority: 50
    rules:
      operator: "NOT"
      conditions:
        - operator: "OR"
          conditions:
            - type: "domain"
              name: "computer_science"
            - type: "domain"
              name: "math"
            - type: "domain"
              name: "physics"
            - type: "domain"
              name: "engineering"
            - type: "domain"
              name: "chemistry"
    modelRefs:
      - model: "general_model"
        use_reasoning: false
    plugins:
      - type: "system_prompt"
        configuration:
          system_prompt: "You are a helpful general-purpose assistant. Answer concisely and clearly."

default_model: general_model

